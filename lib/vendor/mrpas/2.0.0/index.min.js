define(function(require,exports,module){/*skullquake*/"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Mrpas=function(){function i(i,t,s){this.mapWidth=i,this.mapHeight=t,this.isTransparent=s}return i.prototype.computeOctantY=function(i,t,s){var a,e,n,r,o,p,h,m,c,f,u=[],l=[],M=1,X=0,Y=0,b=0;for(e=s.originY+t;e>=s.minY&&e<=s.maxY;e+=t,Y=X,++M)for(n=.5/M,f=-1,r=Math.floor(b*M+.5),a=s.originX+r*i;r<=M&&a>=s.minX&&a<=s.maxX;a+=i,++r,f=c){if(o=!0,p=!1,m=f,c=(h=r/M)+n,Y>0)if(s.isVisible(a,e-t)&&this.isTransparent(a,e-t)||s.isVisible(a-i,e-t)&&this.isTransparent(a-i,e-t)){for(var x=0;x<Y&&o;++x)if(m<=l[x]&&c>=u[x])if(this.isTransparent(a,e)){if(h>u[x]&&h<l[x]){o=!1;break}}else{if(m>=u[x]&&c<=l[x]){o=!1;break}u[x]=Math.min(u[x],m),l[x]=Math.max(l[x],c),p=!0}}else o=!1;o&&(s.setVisible(a,e),this.isTransparent(a,e)||(b>=m?b=c:p||(u[X]=m,l[X++]=c)))}},i.prototype.computeOctantX=function(i,t,s){var a,e,n,r,o,p,h,m,c,f,u=[],l=[],M=1,X=0,Y=0,b=0;for(a=s.originX+i;a>=s.minX&&a<=s.maxX;a+=i,Y=X,++M)for(n=.5/M,f=-1,r=Math.floor(b*M+.5),e=s.originY+r*t;r<=M&&e>=s.minY&&e<=s.maxY;e+=t,++r,f=c){if(o=!0,p=!1,m=f,c=(h=r/M)+n,Y>0)if(s.isVisible(a-i,e)&&this.isTransparent(a-i,e)||s.isVisible(a-i,e-t)&&this.isTransparent(a-i,e-t)){for(var x=0;x<Y&&o;++x)if(m<=l[x]&&c>=u[x])if(this.isTransparent(a,e)){if(h>u[x]&&h<l[x]){o=!1;break}}else{if(m>=u[x]&&c<=l[x]){o=!1;break}u[x]=Math.min(u[x],m),l[x]=Math.max(l[x],c),p=!0}}else o=!1;o&&(s.setVisible(a,e),this.isTransparent(a,e)||(b>=m?b=c:p||(u[X]=m,l[X++]=c)))}},i.prototype.setMapDimensions=function(i,t){this.mapWidth=i,this.mapHeight=t},i.prototype.compute=function(i,t,s,a,e){e(i,t);var n={minX:Math.max(0,i-s),minY:Math.max(0,t-s),maxX:Math.min(this.mapWidth-1,i+s),maxY:Math.min(this.mapHeight-1,t+s),originX:i,originY:t,radius:s,isVisible:a,setVisible:e};this.computeOctantY(1,1,n),this.computeOctantX(1,1,n),this.computeOctantY(1,-1,n),this.computeOctantX(1,-1,n),this.computeOctantY(-1,1,n),this.computeOctantX(-1,1,n),this.computeOctantY(-1,-1,n),this.computeOctantX(-1,-1,n)},i}();exports.Mrpas=Mrpas;});
