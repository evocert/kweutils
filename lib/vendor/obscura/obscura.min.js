(function(){var a,b,c=function(a,b){return function(){return a.apply(b,arguments)}};b=typeof exports!="undefined"&&exports!==null?exports:this,a=function(a,b){var d;return b==null&&(b=null),d=/\.((jp(e)?g)|(png)|(gif))$/i,this.onLoad=c(function(){return!0},this),this.setUpImageData=c(function(){return this.dimensions={w:this.image.width,h:this.image.height},this.imageDimensions=this.dimensions,this.canvas.width=this.canvas.height=this.dimensions.w>this.dimensions.h?this.dimensions.w*2:this.dimensions.h*2,this.load(0,0,this.image.width,this.image.height,this.image)},this),this.load=c(function(a,b,c,d,e){return a==null&&(a=0),b==null&&(b=0),c==null&&(c=this.image.width),d==null&&(d=this.image.height),e==null&&(e=this.target),this.context.globalCompositeOperation="copy",this.context.drawImage(e,0,0,this.imageDimensions.w,this.imageDimensions.h,a,b,c,d),this.imageDimensions={w:c,h:d},this.render(),this},this),this.render=c(function(){return this.target.width=this.dimensions.w,this.target.height=this.dimensions.h,this.target.getContext("2d").globalCompositeOperation="copy",this.target.getContext("2d").drawImage(this.canvas,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this},this),this.save=c(function(){return this.target.toDataURL()},this),this.resize=c(function(a,b,c){var d,e;b==null&&(b=!0),c==null&&(c=!1),this.context.save(),Object.prototype.toString.call(a)==="[object Array]"?a={w:a[0],h:a[1]}:typeof a!="object"&&(a={w:a,h:a}),a.w=typeof a.w=="string"&&a.w.match(/%/)?this.dimensions.w*(parseFloat(a.w)/100):parseFloat(a.w),a.h=typeof a.h=="string"&&a.h.match(/%/)?this.dimensions.h*(parseFloat(a.h)/100):parseFloat(a.h),d=this.dimensions,this.dimensions=a,e=a;if(b){if(a.w>a.h||a.w===a.h&&d.w>d.h)e.w=a.w,e.h=a.w/d.w*d.h;else if(a.h>a.w||a.h===a.w&&d.h>d.w)e.w=a.h/d.h*d.w,e.h=a.h;c||(this.dimensions=e)}return this.context.drawImage(this.target,0,0,e.w,e.h),this.render(),this.imageDimensions=this.dimensions,this.context.restore(),this},this),this.crop=c(function(a,b,c,d){var e;return this.context.save(),e=this.dimensions,this.dimensions={w:c,h:d},this.context.drawImage(this.target,a,b,c,d,0,0,c,d),this.imageDimensions={w:c,h:d},this.render(),this.context.restore(),this},this),this.fit=c(function(a,b){this.context.save();if(a>this.canvas.width&&b>this.canvas.height)return this;if(a<b||this.imageDimensions.w>this.imageDimensions.h||a===b&&this.imageDimensions.h>this.imageDimensions.w)b=a/this.imageDimensions.w*this.imageDimensions.h;else if(b<a||this.imageDimensions.h>this.imageDimensions.w||b===a&&this.imageDimensions.w>this.imageDimensions.h)a=b/this.imageDimensions.h*this.imageDimensions.w;return this.dimensions={w:a,h:b},this.context.drawImage(this.target,0,0,a,b),this.imageDimensions=this.dimensions,this.render(),this.context.restore(),this},this),this.rotate=c(function(a,b){var c,d,e,f,g,h,i,j,k,l;b==null&&(b="center"),this.context.restore(),this.context.save(),k=this.dimensions,f=k.w,e=k.h;if(a===90||a===120)l={h:e,w:f},d=l.cw,c=l.ch;else if(a!==180||a!==360)d=f*Math.cos(a*Math.PI/180)+e*Math.sin(a*Math.PI/180),c=e*Math.cos(a*Math.PI/180)+f*Math.sin(a*Math.PI/180);return this.context.globalCompositeOperation="copy",typeof b!="object"&&(b.match(/(top)/)?(i=0,j=(c-e)/2):b.match(/(bottom)/)?(i=c,j=c-(c-e)/2):b.match(/(center)/)&&(i=c/2,j=e/2),b.match(/(left)/)?(g=0,h=(d-f)/2):b.match(/(middle)/)?(g=d,h=d-(d-f)/2):b.match(/(center)/)&&(g=d/2,h=f/2)),this.dimensions.w=d,this.dimensions.h=c,this.context.translate(g,i),this.context.rotate(a*Math.PI/180),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.drawImage(this.target,0,0,f,e,-h,-j,f,e),this.imageDimensions=this.dimensions,this.context.restore(),this.render(),this},this),this.flip=c(function(a){return a==null&&(a="horizontal"),this.context.save(),a==="horizontal"?(this.context.translate(this.dimensions.w,0),this.context.scale(-1,1)):(this.context.translate(0,this.dimensions.h),this.context.scale(1,-1)),this.context.drawImage(this.target,0,0),this.context.restore(),this.render(),this},this),this.reflect=c(function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;a==null&&(a=.5),b==null&&(b=0),c==null&&(c=.25),d==null&&(d="vertical"),this.context.save(),h=document.createElement("canvas"),h.width=this.imageDimensions.w,h.height=this.imageDimensions.h,i=h.getContext("2d"),this.context.globalCompositeOperation="source-over",p={x:0,y:0},q={x:0,y:0},s=this.imageDimensions,r=s.w,k=s.h,this.context.drawImage(this.target,0,0),d==="vertical"&&(k=this.imageDimensions.h*c,this.dimensions.h=this.imageDimensions.h+b+k,i.translate(0,k),i.scale(1,-1),this.context.translate(0,k),this.context.scale(1,-1),q.y=this.dimensions.h,p.y=this.imageDimensions.h-k),j=i.getImageData(0,0,r,k),i.drawImage(this.target,p.x,p.y,r,k,0,0,r,k),l=this.context.getImageData(0,0,r,k),n=i.getImageData(0,0,r,k),m=1,g=1,o=1,f=255*a/k;while(!(o>k)){while(!(g>r))e=n.data[o*r*4+g*4+3],e=Math.min(e,(k-(o-1))*f),n.data[o*r*4+g*4+3]=e,g++;g=1,o++}return this.context.putImageData(n,0,this.imageDimensions.h),this.imageDimensions=this.dimensions,this.render(),this.context.restore(),this},this),this.target=b!==null?document.querySelector(b):document.createElement("canvas"),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),a.match(d)?(this.image=new Image,this.image.onload=c(function(){return this.setUpImageData(),this.onLoad()},this),this.image.src=a):(this.image=document.querySelector(a),this.setUpImageData()),this},b.obscura=a}).call(this)
