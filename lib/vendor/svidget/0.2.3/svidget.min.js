/* Svidget.js v0.2.3 on 2015-03-01, Copyright 2014 Joe Agster http://www.svidget.org MIT License */
!function(a,b){a.document||console.warn("svidget requires a global windowy object with window.document to work correctly."),"function"==typeof define&&define.amd?define(["svidget"],b(a)):"object"==typeof module&&module.exports?module.exports=b(a):a.svidget=b(a)(a)}(this,function(a){var b="0.2.3",c={},d=a,e=d.document||{};c.root=d,c.document=e,c.version=b,c.declaredHandlerName="_declared",c.emptyArray=[],c.array=function(a){if(!a||!a.length)return null;try{return c.emptyArray.slice.call(a,0)}catch(b){for(var d=[],e=0;e<a.length;e++)d.push(a[e]);return d}},c.isArray=function(a){return null!=a&&(Array.isArray(a)||Array.prototype.isPrototypeOf(a)||a.length&&a.push)},c.isFunction=function(a){return"function"==typeof a},c.isString=function(a){return"string"==typeof a||a.length&&a.trim&&a.charAt},c.isColor=function(){return!1},c.convert=function(a,b,d,e){return c.Conversion.to(a,b,d,e)},c.extend=function(a,b,c){for(var d in b)(c||void 0===a.prototype[d])&&(a.prototype[d]=b[d])},c.wrap=function(a,b){if(null==a||"function"!=typeof a)return void 0;var c=function(){return a.apply(b,arguments)};return c},c.findFunction=function(a,b){if("function"==typeof a)return a;if(null==b&&(b=c.root),null!=a){var d=a+"",e=b[d];return null==e?null:"function"==typeof e?e:new Function("return "!=d.substr(0,7)?"return "+d:d)}return null},c.log=function(a){c.Settings.enableLogging&&console.log(a)},c.readOnlyProperty=function(a){return{enumerable:!0,configurable:!1,writable:!1,value:a}},c.fixedProperty=function(a){return{enumerable:!0,configurable:!1,writable:!0,value:a}},c.getPrivateAccessor=function(a){return function(b){return a[b]}},c.setPrivateAccessor=function(a){return function(b,c){return a.writable.contains(b)?(a[b]=c,!0):!1}},c.returnFalse=function(){return!1},c.returnTrue=function(){return!0},c.Settings={},c.Settings.showPrivates=!0,c.Settings.enableLogging=!1,Array.prototype.contains||(Array.prototype.contains=function(a){for(var b=this.length;b--;)if(this[b]===a)return!0;return!1}),Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),c.ObjectPrototype={setup:function(a){this.getPrivate=c.getPrivateAccessor(a),this.setPrivate=c.setPrivateAccessor(a),c.Settings.showPrivates&&(this.privates=a)},getset:function(a,b,c){var d=this.getPrivate(a);if(void 0===b)return d;if(c&&!c(b))return!1;var e=this.setPrivate(a,b);return e},select:function(a,b){return"number"==typeof b?(b=parseInt(b),a.wrap(a.getByIndex(b))):void 0!==b?a.wrap(a.getByName(b+"")):a},selectFirst:function(a,b){return"number"==typeof b?(b=parseInt(b),a.getByIndex(b)):void 0!==b?a.getByName(b+""):a.first()},wireCollectionAddRemoveHandlers:function(a,b,d){null!=a&&(a.onAdded(c.wrap(b,this)),a.onRemoved(c.wrap(d,this)))}},c.EventPrototype=function(a){this.eventTypes=new c.Collection(a)},c.EventPrototype.prototype={on:function(a,b,d,e){return e=e||(c.isFunction(d)?d:c.isFunction(b)?b:null),b=arguments.length>2?b:null,d=void 0!==d&&e!==d?d:null,this.addHandler(a,e,d,b)},off:function(a,b){var d=c.isFunction(b)?b:null,e=null!=d?null:b;return this.removeHandler(a,d,e)},trigger:function(a,b,d){if(null!=a){var e=this.triggerHandlers(a,b,d);c.log("trigger: "+a),e.isPropagationStopped()||this.bubble(a,e)}},triggerHandlers:function(a,b,d){var e=new c.Event(null,a,null,this.getTarget(),d,b);if(null==a||null==this.handlers||null==this.handlers[a])return e;var f=this.handlers[a];return f.each(function(a){return e.isImmediatePropagationStopped()?!1:void(null!=a&&null!=a.handler&&"function"==typeof a.handler&&(e.name=a.name,e.data=a.data,a.handler.call(null,e)))}),e},bubble:function(a,b){this.ensureBubbleParents(),b.name=null,b.data=null,this.bubbleParents[a]&&this.bubbleParents[a](a,b,this.getTarget())},addHandler:function(a,b,c,d){if(this.ensureHandlersByType(a),this.handlerExists(a,b,c))return!1;var e=this.toHandlerObject(b,c,d);return this.handlers[a].push(e),!0},removeHandler:function(a,b,c){if(this.ensureHandlers(),!this.handlers[a])return!1;var d=this;return this.handlers[a].removeWhere(function(a){return d.handlerMatch(a,b,c)})},handlerExists:function(a,b,c){var d=this,e=this.handlers[a].any(function(a){return d.handlerMatch(a,b,c)});return e},handlerMatch:function(a,b,c){return null!=c&&a.name===c?!0:b===a.handler?!0:!1},setBubbleParent:function(a,b){this.ensureBubbleParents(),this.bubbleParents[a]=b},registerBubbleCallback:function(a,b,d){if(b&&d)for(var e=0;e<a.length;e++)this.setBubbleParent(a[e],c.wrap(d,b))},toHandlerObject:function(a,b,c){var d={handler:a,name:b,data:c};return d},bubbleFuncs:function(){},ensureHandlers:function(){this.handlers||(this.handlers={})},ensureHandlersByType:function(a){this.ensureHandlers(),this.handlers[a]||(this.handlers[a]=new c.Collection)},ensureBubbleParents:function(){this.bubbleParents||(this.bubbleParents={})},getTarget:function(){return this}},c.ParamPrototype={name:function(){var a=this.getPrivate("name");return a},description:function(a){var b=this.getset("description",a);return void 0!==a&&b?(this.trigger&&this.trigger("change",{property:"description",value:a}),!0):b},type:function(a){var b=this.getset("type",a,this.validateType);return void 0!==a&&b?(this.trigger&&this.trigger("change",{property:"type",value:a}),!0):b},subtype:function(a){var b=this.getset("subtype",a,this.validateSubtype);return void 0!==a&&b?(this.trigger&&this.trigger("change",{property:"subtype",value:a}),!0):b},typedata:function(a){var b=this.getset("typedata",a);return void 0!==a&&b?(this.trigger("change",{property:"typedata",value:a}),!0):b},defvalue:function(a){var b=this.getset("defvalue",a,this.validateSubtype);return void 0!==a&&b?(this.trigger&&this.trigger("change",{property:"defvalue",value:a}),!0):b},validateType:function(a){return void 0!=c.ParamTypes[a]},validateSubtype:function(a){return void 0!=c.ParamSubTypes[a]}},c.Collection=function(a){this.__type="Svidget.Collection",this.source=a,a&&(c.isArray(a)||Array.prototype.isPrototypeOf(a))&&this.push.apply(this,a)},c.Collection.prototype=new Array,c.extend(c.Collection,{any:function(a){if(null==a)return this.length>0;for(var b=0;b<this.length;b++)if(a(this[b]))return!0;return!1},all:function(a){if(null==a)return!1;for(var b=0;b<this.length;b++)if(!a(this[b]))return!1;return!0},contains:function(a){return this.indexOf(a)>=0},each:function(a){for(var b=0;b<this.length;b++){var c=a(this[b]);if(c===!1)break}},first:function(a){if(0==this.length)return null;if(null==a)return this[0];for(var b=0;b<this.length;b++)if(a(this[b]))return this[b];return null},last:function(a){if(0==this.length)return null;if(null==a)return this[0];for(var b=this.length-1;b>=0;b--)if(a(this[b]))return this[b];return null},select:function(a){for(var b=[],d=0;d<this.length;d++)b.push(a(this[d]));return new c.Collection(b)},where:function(a){for(var b=[],d=0;d<this.length;d++)a(this[d])&&b.push(this[d]);return new c.Collection(b)},add:function(a){var b=this.indexOf(a);return b>=0?!1:(this.push(a),!0)},addRange:function(a){return c.isArray(a)?(this.push.apply(this,a),!0):!1},insert:function(a,b){return b=parseInt(b),!isNaN(b)&&(0>b||b>this.length)?!1:(this.splice(b,0,a),!0)},remove:function(a){var b=this.indexOf(a);return 0>b?!1:(this.splice(b,1),!0)},removeAll:function(a){for(var b=!1;this.remove(a);)b=!0;return b},removeWhere:function(a){for(var b=[],c=!1,d=0;d<this.length;d++)a(this[d])&&b.push(this[d]);for(var d=0;d<b.length;d++)c=this.remove(b)||c;return c},toArray:function(){for(var a=[],b=0;b<this.length;b++)a.push(this[b]);return a}}),c.ObjectCollection=function(a,b){c.Collection.apply(this,[a]),this.__type="Svidget.ObjectCollection";var d=new function(){this.writable=["addedFunc","removedFunc"],this.type=b,this.addedFunc=null,this.removedFunc=null};this.setup(d)};var f=new c.Collection;return c.ObjectCollection.prototype=f,c.ObjectCollection.prototype.base_add=f.add,c.ObjectCollection.prototype.base_remove=f.remove,c.extend(c.ObjectCollection,{get:function(a){return"number"==typeof a?col.getByIndex(a):col.getByName(a)},getByIndex:function(a){return null==a||isNaN(a)?null:(a=parseInt(a),this[a])},getByName:function(a){return this.first(function(b){return b.name()==a})},type:function(){return this.getset("type")},add:function(){if(0==arguments.length)return null;var a,b,c;return arguments.length>=1&&(b=arguments[0]),a="string"==typeof b?this.create.apply(this,arguments):b,null==a?null:(c=this.addObject(a))?(this.triggerAdded(a),a):null},addObject:function(a){return null==a||!a instanceof this.type()?!1:void 0!==a.name&&null!=this.getByName(a.name())?!1:(this.push(a),a)},create:function(){return null},remove:function(a){var b=this.getByName(a);if(null==b)return!1;var c=this.base_remove(b);return c?(this.triggerRemoved(b),!0):!1},wrap:function(a){var b=[a];(null==a||!a instanceof this.type())&&(b=[]);var c=new this.constructor(b,this.parent);return c},onAdded:function(a){this.getset("addedFunc",a)},onRemoved:function(a){this.getset("removedFunc",a)},triggerAdded:function(a){var b=this.getset("addedFunc");b&&b(a)},triggerRemoved:function(a){var b=this.getset("removedFunc");b&&b(a)}},!0),c.extend(c.Collection,c.ObjectPrototype),c.Communicator=function(){this.__type="Svidget.Communicator",this.sameDomain=null,this._init()},c.Communicator.prototype={_init:function(){this.addMessageEvent()},addMessageEvent:function(){d.addEventListener&&d.addEventListener("message",c.wrap(this.receiveXSM,this),!1)},receiveFromParent:function(a,b){svidget.receiveFromParent(a,b)},receiveFromWidget:function(a,b,c){svidget.receiveFromWidget(a,b,c)},receiveXSM:function(a){if(null!=a){var b=a.data;null!=b&&(void 0!==b.widget?this.receiveFromWidget(b.name,b.payload,b.widget):this.receiveFromParent(b.name,b.payload))}},signalParent:function(a,b,c){this.isParentSameDomain()?this.signalParentDirect(a,b,c):this.signalParentXSM(a,b,c)},signalParentDirect:function(a,b,c){if(null!=d.parent&&d!==d.parent&&null!=d.parent.svidget&&d.parent.svidget){var e=d.parent.svidget;setTimeout(function(){e.routeFromWidget(a,b,c)},0)}},signalParentXSM:function(a,b,c){if(null!=d.parent&&null!=d.parent.postMessage){var e=this.buildSignalParentMessage(a,b,c);d.parent.postMessage(e,"*")}},buildSignalParentMessage:function(a,b,c){return{name:a,payload:b,widget:c}},isParentSameDomain:function(){return null==this.sameParentDomain&&(this.sameParentDomain=this.checkParentSameDomain()),this.sameParentDomain},checkParentSameDomain:function(){if(null==d.parent)return!1;try{{d.parent.document}return!0}catch(a){return!1}},signalWidget:function(a,b,d){c.log("communicator: signalWidget {name: "+b+"}"),a.isCrossDomain()?this.signalWidgetXSM(a,b,d):this.signalWidgetDirect(a,b,d)},signalWidgetDirect:function(a,b,c){if(null!=a){var d=a.root();null!=d&&setTimeout(function(){d.receiveFromParent(b,c)},0)}},signalWidgetXSM:function(a,b,d){if(null!=a&&null!=a.window()){var e=this.buildSignalWidgetMessage(b,d);setTimeout(function(){c.log("communicator: postMessage"),a.window().postMessage(e,"*")},0)}},buildSignalWidgetMessage:function(a,b){return{name:a,payload:b}}},c.Conversion={},c.Conversion.to=function(a,b,d,e){var f=c.ParamTypes[b]||c.ParamTypes.object,g=c.ParamSubTypes[d]||c.ParamSubTypes.none;switch(f){case c.ParamTypes.string:return c.Conversion.toString(a,g,e);case c.ParamTypes.number:return c.Conversion.toNumber(a,g==c.ParamSubTypes.integer);case c.ParamTypes.bool:return c.Conversion.toBool(a);case c.ParamTypes.array:return c.Conversion.toArray(a);default:return c.Conversion.toObject(a)}},c.Conversion.toString=function(a,b,d){return b==c.ParamSubTypes.choice?c.Conversion.toChoiceString(a,d):c.isArray(a)||"object"==typeof a?JSON.stringify(a):a+""},c.Conversion.toChoiceString=function(a,b){if(!b)return null;var c=b.split("|");return null==c||0==c.length?null:c.indexOf(a)>=0?a:c[0]},c.Conversion.toNumber=function(a,b){return a?a===!0?1:b?parseInt(a+""):+a:0},c.Conversion.toBool=function(a){var b=a+"";return"false"==b.toLowerCase()?!1:0===+a?!1:!!a},c.Conversion.toArray=function(a){if(null==a)return a;if(c.isArray(a))return a;if(c.Conversion.isArrayString(a)){var b=c.Conversion.parseArray(a);if(null!=b)return b}return[a]},c.Conversion.toObject=function(a){if(null==a)return a;if(c.Conversion.isJSONString(a)){a=c.Conversion.jsonifyString(a);try{return JSON.parse(a)}catch(b){}}return a},c.Conversion.isJSONString=function(a){return a?(a=a.trim(),a.length>0&&c.isString(a)&&"{"==a.charAt(0)&&"}"==a.charAt(a.length-1)):!1},c.Conversion.isArrayString=function(a){return a?(a=a.trim(),a.length>0&&c.isString(a)&&"["==a.charAt(0)&&"]"==a.charAt(a.length-1)):!1},c.Conversion.isQuotedString=function(a){return a?(a=a.trim(),a.length>0&&c.isString(a)&&("'"==a.charAt(0)&&"'"==a.charAt(a.length-1)||'"'==a.charAt(0)&&'"'==a.charAt(a.length-1))):!1},c.Conversion.parseArray=function(a){a=c.Conversion.jsonifyString(a);var b='{"d":'+a+"}";try{var d=JSON.parse(b);return d&&d.d?d.d:null}catch(e){return null}},c.Conversion.jsonifyString=function(a){if(null==a||a.indexOf("'")<0)return a;for(var b="'",c='"',d="\\",e="",f=!1,g=null,h=!1,i=0;i<a.length;i++){var j=a[i],k=j;j==b||j==c?h?(g==b&&j==b?e=e.substr(0,e.length-1):g==b&&j==c&&(k=d+d+c),h=!1):f&&j==g?(f=!1,g=null,k=c):f&&j==c?k=d+c:f||(g=j,f=!0,k=c):j==d&&(h=!0),e+=k}return e},c.DOM={get:function(a){return e.getElementById?e.getElementById(a):null},getByName:function(a,b){return this.getChildrenByName(e,a,b)},getByNameNS:function(a,b,d){if(!e.getElementsByTagNameNS)return null;var f=e.getElementsByTagNameNS(a,b);return d?new c.Collection(c.array(f)):f},getByNameSvidget:function(a,b){return this.getByNameNS(c.Namespaces.svidget,a,b)},getChildrenByName:function(a,b,d){var e=a.getElementsByTagName(b);return d?new c.Collection(c.array(e)):e},getElement:function(a){return"string"==typeof a?this.get(a):a},getItem:function(a){return this.wrap(this.get(a))},select:function(a){function b(a){if(null==a)return null;var b,d=/@([^=#\s]+)$/g,f=a,g=d.exec(a);g&&(b=g[1],f=f.replace(g[0],""));var h;try{h=e.querySelectorAll(f)}catch(i){return null}for(var j=[],k=0;k<h.length;k++){var l,m=h[k];if(b){var n=c.DOM.attr(m,b);null!=n&&(l=new c.DOMItem(n))}else l=new c.DOMItem(m);l&&j.push(l)}return new c.Collection(j)}if(!e.querySelectorAll)return null;if(null==a)return null;var d,f=/@[^=#\s]+/g,g=f.test(a),h=new c.Collection;if(g)for(var i=a.split(","),j=0;j<i.length;j++)d=b(i[j]),d&&h.addRange(d);else d=b(a),d&&h.addRange(d);var k=new c.DOMQuery(h,a);return k},selectElement:function(a){if("string"==typeof a){var b=this.select(a);return null==b||0==b.length?null:b.item(0).source()}return this.isElement(a)?a:null},wrap:function(a){return new c.DOMItem(a)},transportize:function(a){return null==a?null:{name:a.localName,namespace:a.namespaceURI,value:a.value,type:1==a.nodeType?c.NodeType.element:2==a.nodeType?c.NodeType.attribute:null}},root:function(){return e.documentElement},rootItem:function(){return this.wrap(this.root())},attr:function(a,b){return a.attributes[b]},attrValue:function(a,b){var c=this.attr(a,b);return c?c.value:null},clone:function(){},cloneDetached:function(){},isDOMNode:function(a){return null==a?null:a.namespaceURI&&a.localName&&a.nodeType&&a.value&&(1==a.nodeType||2==a.nodeType)},fromNodeType:function(a){return 1==a?"element":2==a?"attribute":3==a?"text":null},text:function(a,b){var c=this.select(a);return void 0===b?this.getText(c):void this.setText(c,b)},getText:function(a){return a.textContent?a.textContent:a.innerHTML?a.innerHTML:null},setText:function(a,b){a.textContent?a.textContent=b+"":a.innerHTML&&(a.innerHTML=b+"")},getDocument:function(a){try{var b=a.contentDocument;return null!=b&&"about:blank"==b.URL?null:b}catch(c){return void 0}},isElementDocumentReady:function(a){return null!==this.getDocument(a)},isElement:function(a){return HTMLElement?a instanceof HTMLElement:void 0},attach:function(){},detach:function(){},disable:function(a){a.disabled=!0},enable:function(a){a.disabled=!1},show:function(a){a.style.display="initial",a.style.visibility="visible"},hide:function(a){a.style.display="none",a.style.visibility="hidden"},on:function(a,b,c,d){d=!!d;var e=!1;return a.addEventListener?(a.addEventListener(b,c,d),e=!0):a.attachEvent&&(a.attachEvent("on"+b,c),e=!0),e},off:function(a,b,c,d){d=!!d;var f=!1;return a.removeEventListener?(a.removeEventListener(b,c,!1),f=!0):e.detachEvent&&(e.detachEvent("on"+b,c),f=!0),f}},c.DOMItem=function(a){function b(a){return null==a?!1:a.namespaceURI&&a.localName&&a.nodeType&&(a.value||a.textContent)&&(1==a.nodeType||2==a.nodeType)}function d(a){return a==c.NodeType.element?"element":a==c.NodeType.attribute?"attribute":null}function e(a){for(var b in c.Namespaces)if(a===c.Namespaces[b])return b}this.__type="Svidget.DOMItem",a=a||{};var f=new function(){this.writable=["value"],this.type=null,this.name=null,this.value=null,this.namespace=null,this.source=a,this.sourceDOM=b(a)};this.setup(f),f.sourceDOM?(f.typeCode=1==a.nodeType?c.NodeType.element:2==a.nodeType?c.NodeType.attribute:null,f.name=a.localName,f.namespace=a.namespaceURI):(f.typeCode=a.type,f.name=a.name,f.namespace=a.namespace),f.value=a.value||a.textContent,f.type=d(f.typeCode),f.namespaceType=e(f.namespace),this.cachedAttributes=null,this.cachedElements=null},c.DOMItem.prototype={typeCode:function(){return this.getset("type")},name:function(){return this.getset("name")},value:function(a){var b=this.source();if(void 0===a)return b.value||b.textContent;var c=a+"";b.value?b.value=c:b.textContent=c},namespace:function(){return this.getset("namespace")},namespaceType:function(){return this.getset("namespaceType")},hasElements:function(){if(this.isAttribute())return!1;var a=this.source();return this.isAttached()||a.children&&a.children.length?a.children.length>0:!1},hasAttributes:function(){if(this.isAttribute())return!1;var a=this.source();return this.isAttached()||a.attributes&&a.attributes.length?a.attributes.length>0:!1},isAttribute:function(){return this.type()==c.NodeType.attribute},elements:function(){if(null!=this.cachedElements&&c.isArray(this.cachedElements))return this.cachedElements;var a=this.isAttached();if(!(a||b.elements&&b.elements.length))return null;var b=this.source(),d=a?b.children:b.elements,e=new c.Collection(c.array(d));return e=e.select(function(a){return new c.DOMItem(a)}),this.cachedElements=e,this.cachedElements},attributes:function(){if(null!=this.cachedAttributes&&c.isArray(this.cachedAttributes))return this.cachedAttributes;var a=this.isAttached();if(!(a||b.attributes&&b.attributes.length))return null;var b=this.source(),d=b.attributes,e=new c.Collection(c.array(d));return e=e.select(function(a){return new c.DOMItem(a)}),this.cachedAttributes=e,this.cachedAttributes},source:function(){return this.getset("source")},isAttached:function(){return this.getset("sourceDOM")}},c.extend(c.DOMItem,c.ObjectPrototype),c.DOMQuery=function(a,b){this.__type="Svidget.DOMQuery";var d=new c.Collection(a),e=new function(){this.writable=[],this.items=d,this.selector=b};this.getPrivate=c.getPrivateAccessor(e),this.setPrivate=c.setPrivateAccessor(e),Object.defineProperty(this,"length",{enumerable:!0,configurable:!1,writable:!1,value:d.length||0})},c.DOMQuery.prototype={items:function(){return this.getset("items")},item:function(a){var b=this.items();return null==b?null:b[a]},hasItems:function(){return this.length>0},selector:function(){return this.getset("selector")},setValue:function(a){this.items().each(function(b){b.value(a)})},toString:function(){return'[Svidget.DOMQuery { selector: "'+this.selector()+'", items: '+this.items().length+"}]"}},c.extend(c.DOMQuery,c.ObjectPrototype),c.DocType={html:0,svg:1},c.DocReadyState={loading:0,interactive:1,complete:2},c.ElementReadyState={uninitialized:0,loading:1,loaded:2,interactive:3,complete:4},c.ParamTypes={object:0,string:1,number:2,bool:3,array:4},c.ParamSubTypes={none:0,color:1,integer:2,regex:3,choice:4},c.NodeType={element:0,attribute:1},c.Namespaces={html:"http://www.w3.org/1999/xhtml",svidget:"http://www.svidget.org/svidget",svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink"},c.Event=function(a,b,d,e,f,g){Object.defineProperty(this,"currentTarget",c.readOnlyProperty(e)),Object.defineProperty(this,"data",c.fixedProperty(d)),Object.defineProperty(this,"name",c.fixedProperty(a)),Object.defineProperty(this,"timeStamp",c.readOnlyProperty(+new Date)),Object.defineProperty(this,"target",c.readOnlyProperty(null==f?e:f)),Object.defineProperty(this,"type",c.readOnlyProperty(b)),Object.defineProperty(this,"value",c.readOnlyProperty(g))},c.Event.prototype={isPropagationStopped:c.returnFalse,isImmediatePropagationStopped:c.returnFalse,stopPropagation:function(){this.isPropagationStopped=c.returnTrue},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue,this.stopPropagation()}},c.EventContainer=function(a,b){this.__type="Svidget.EventContainer",c.EventPrototype.apply(this,[a]),this.target=b},c.EventContainer.prototype=new c.EventPrototype,c.extend(c.EventContainer,{getTarget:function(){return this.target}},!0),c.Root=function(){this.__type="Svidget.Root";var a=this,b=new function(){this.writable=["current","widgets","connected","loaded"],this.comm=new c.Communicator,this.eventContainer=new c.EventContainer(["loaded"],a),this.loaded=!1,this.current=null,this.connected=!1,this.widgets=null};this.setup(b),this.isBrowser=!0,this.docType=null,this.setCurrent=function(a){b.current=a},this._init()},c.Root.prototype={_init:function(){this._initEvents(),this._initPrototypes(),this.initInternal(),this._initReady()},_initEvents:function(){},_initPrototypes:function(){this.isWidget()?c.extend(c.Root,c.Root.WidgetPrototype,!0):c.extend(c.Root,c.Root.PagePrototype,!0)},_initReady:function(){this.isDomReady()?this._ready():this.addReadyEvents()},initInternal:function(){},_ready:function(){this.isReady=!0,this.isWidget()?this.readyWidget():this.readyPage()},getDocType:function(){if(!e.documentElement)return c.DocType.html;var a=e.documentElement.localName,b=e.documentElement.namespaceURI;return"svg"==a&&b==c.Namespaces.svg?c.DocType.svg:c.DocType.html},isWidget:function(){return this.docType=this.getDocType(),this.docType==c.DocType.svg},isDomReady:function(){var a=e.readyState;return null!=a&&c.DocReadyState[a]?c.DocReadyState[a]>=c.DocReadyState.interactive:!1},addReadyEvents:function(){var a=c.wrap(this.readyHandler,this);c.DOM.on(e,"DOMContentLoaded",a),c.DOM.on(e,"readystatechange",a),c.DOM.on(d,"load",a)},readyHandler:function(){this.ensureReady()},ensureReady:function(){this.isReady||this._ready(),this.isReady=!0},markLoaded:function(){this.getset("loaded")!==!0&&(this.getset("loaded",!0),this.triggerLoad())},eventContainer:function(){return this.getset("eventContainer")},on:function(a,b,c,d){this.eventContainer().on(a,b,c,d)},off:function(a,b){this.eventContainer().off(a,b)},trigger:function(a,b){this.eventContainer().trigger(a,b)},loaded:function(a,b,c){this.onload(a,b,c)},onload:function(a,b,c){this.on("load",a,b,c)},offload:function(a){this.off("load",a)},offdeclaredload:function(){this.off("load",c.declaredHandlerName)},widgetloaded:function(a,b,c){this.widgetloaded(a,b,c)},onwidgetload:function(a,b,c){this.on("widgetload",a,b,c)},offwidgetload:function(a){this.off("widgetload",a)},offdeclaredwidgetload:function(){this.off("widgetload",c.declaredHandlerName)},triggerLoad:function(){this.trigger("load")},triggerWidgetLoad:function(a){this.trigger("widgetload",a)},comm:function(){return this.getset("comm")},routeFromParent:function(a,b){c.log("root: routeFromParent {name: "+a+"}"),this.comm().receiveFromParent(a,b)},routeFromWidget:function(a,b,d){c.log("root: routeFromWidget {name: "+a+"}"),this.comm().receiveFromWidget(a,b,d)},receiveFromParent:function(){},receiveFromWidget:function(){},current:function(){return null},connected:function(a){var b=this.getset("connected",a);return void 0!==a&&b?!0:b}},c.extend(c.Root,c.ObjectPrototype),c.Util={},c.Util.queryString=function(a,b){var e={};if(!d.location)return e;for(var f,g=null==d.location.search||d.location.search.length>0?d.location.search:"",h=/\+/g,i=/([^&=]+)=?([^&]*)/g,j=function(a){return decodeURIComponent(a.replace(h," "))},k=g.substring(1);f=i.exec(k);){var l=j(f[1]),m=j(f[2]);a?void 0!==e[l]?c.isArray(e[l])?e[l].push(m):e[l]=[e[l],m]:e[l]=m:(b||void 0===e[l])&&(e[l]=m)}return e},c.Action=function(a,b,d){this.__type="Svidget.Action",b=b||{},d=d instanceof c.Widget?d:null;var e=this,f=new function(){this.writable=["binding","enabled","external","description"],this.params=new c.ActionParamCollection([],e),this.name=a,this.description=b.description,this.enabled=b.enabled!==!1,this.binding=b.binding||null,this.external=b.external!==!1,this.widget=d,this.bindingFunc=null};this.setup(f),f.bindingFunc=c.findFunction(f.binding),this.registerBubbleCallback(c.Action.eventTypes,d,d.actionBubble),this.wireCollectionAddRemoveHandlers(f.params,e.paramAdded,e.paramRemoved)},c.Action.prototype={name:function(){var a=this.getPrivate("name");return a},attached:function(){this.getset("widget");return null!=this.widget&&this.widget instanceof c.Widget},enabled:function(a){var b=this.getset("enabled",a);return void 0!==a&&b?(this.trigger("change",{property:"enabled",value:a}),!0):b},description:function(a){var b=this.getset("description",a);return void 0!==a&&b?(this.trigger("change",{property:"description",value:a}),!0):b},external:function(a){var b=this.getset("external",a);return void 0!==a&&b?(this.trigger("change",{property:"external",value:a}),!0):b},binding:function(a){if(void 0!==a){"function"!=typeof a&&(a+="");var b=c.findFunction(a);this.getset("bindingFunc",b)}var d=this.getset("binding",a);return void 0!==a&&d?(this.trigger("change",{property:"binding",value:val}),!0):d},bindingFunc:function(){var a=this.getset("bindingFunc");return a},invoke:function(){if(!this.enabled())return!1;var a=this.invocableBindingFunc();if(!a)return!1;var b=this.buildArgumentArray(c.array(arguments)),d=a.apply(null,b);return this.trigger("invoke",{returnValue:d}),!0},invokeApply:function(a){this.invoke.apply(this,a)},invocableBindingFunc:function(){var a=this.bindingFunc();return null==a||"function"!=typeof a?null:a},buildArgumentArray:function(a){var b=[];a=null==a?[]:a;for(var c=this.params(),d=0;d<c.length;d++){var e=c[d],f=void 0;d<a.length&&(f=a[d]),void 0===f&&(f=e.defvalue()),b.push(f)}return b},toArgumentObject:function(a){for(var b={},c=this.params(),d=0;d<c.length;d++){var e=c[d],f=void 0;d<a.length&&(f=a[d]),void 0===f&&(f=e.defvalue()),b[e.name()]=f}return b},params:function(a){var b=this.getset("params");return this.select(b,a)},param:function(a){var b=this.getset("params"),c=this.selectFirst(b,a);return c},addParam:function(a,b){return this.params().add(a,b,this)},removeParam:function(a){return this.params().remove(a)},paramBubble:function(a,b,c){"change"==a&&this.paramChanged(c,b.value)},paramChanged:function(a,b){c.log("action: param changed: "+a.name()),this.trigger("paramchange",b,a)},paramAdded:function(a){c.log("action: param added: "+a.name()),this.trigger("paramadd",a)},paramRemoved:function(a){c.log("action: param removed: "+a.name()),this.trigger("paramremove",a.name())},onchange:function(a,b,c){return this.on("change",a,b,c)},ondeclaredchange:function(a){return this.onchange(null,c.declaredHandlerName,a)},offchange:function(a){this.off("change",a)},offdeclaredchange:function(){return this.offchange(c.declaredHandlerName)},oninvoke:function(a,b,c){return this.on("invoke",a,b,c)},ondeclaredinvoke:function(a){return this.oninvoke(null,c.declaredHandlerName,a)},offinvoke:function(a){return this.off("invoke",a)},offdeclaredinvoke:function(){return this.offinvoke(c.declaredHandlerName)},onparamadd:function(a,b,c){return this.on("paramadd",a,b,c)},ondeclaredparamadd:function(a){return this.onparamadd(null,c.declaredHandlerName,a)},offparamadd:function(a){return this.off("paramadd",a)},offdeclaredparamadd:function(){return this.offparamadd(c.declaredHandlerName)},onparamremove:function(a,b,c){return this.on("paramremove",a,b,c)},ondeclaredparamremove:function(a){return this.onparamremove(null,c.declaredHandlerName,a)},offparamremove:function(a){return this.off("paramremove",a)},offdeclaredparamremove:function(){return this.offparamremove(c.declaredHandlerName)},onparamchange:function(a,b,c){return this.on("paramchange",a,b,c)},ondeclaredparamchange:function(a){return this.onparamchange(null,c.declaredHandlerName,a)},offparamchange:function(a){return this.off("paramchange",a)},offdeclaredparamchange:function(){return this.offparamchange(c.declaredHandlerName)},toTransport:function(){var a={name:this.name(),description:this.description(),external:this.external(),enabled:this.enabled(),params:this.toParamsTransport()};return a},toParamsTransport:function(){var a=this.params(),b=a.select(function(a){return a.toTransport()}).toArray();return b},toString:function(){return'[Svidget.Action { name: "'+this.name()+'" }]'}},c.Action.eventTypes=["invoke","change","paramchange","paramadd","paramremove"],c.Action.optionProperties=["external","binding","enabled","description"],c.Action.allProxyProperties=["name","external","enabled","description"],c.Action.writableProxyProperties=[],c.extend(c.Action,c.ObjectPrototype),c.extend(c.Action,new c.EventPrototype(c.Action.eventTypes)),c.ActionCollection=function(a,b){c.ObjectCollection.apply(this,[a,c.Action]),this.__type="Svidget.ActionCollection";this.parent=b},c.ActionCollection.prototype=new c.ObjectCollection,c.extend(c.ActionCollection,{create:function(a,b,d){if(null==a)return null;if(null!=this.getByName(a))return null;var e=new c.Action(a,b,d);return e}},!0),c.ActionParam=function(a,b,d){this.__type="Svidget.ActionParam",b=b||{},d=d instanceof c.Action?d:null;var e=new function(){this.writable=["type","subtype","description","defvalue"],this.name=a,this.description=b.description,this.type=b.type||"string",this.subtype=b.subtype||null,this.defvalue=b.defvalue,this.parent=d};this.setup(e),this.registerBubbleCallback(c.ActionParam.eventTypes,d,d.paramBubble)},c.ActionParam.prototype={toTransport:function(){var a={name:this.name(),type:this.type(),subtype:this.subtype(),description:this.description()};return a},onchange:function(a,b,c){return this.on("change",a,b,c)},ondeclaredchange:function(a){return this.onchange(null,c.declaredHandlerName,a)},offchange:function(a){this.off("change",a)},offdeclaredchange:function(){return this.offchange(c.declaredHandlerName)},toString:function(){return'[Svidget.ActionParam { name: "'+this.name+'" }]'}},c.ActionParam.eventTypes=["change"],c.ActionParam.optionProperties=["type","subtype","description","defvalue"],c.ActionParam.allProxyProperties=["name","type","subtype","description","defvalue"],c.ActionParam.writableProxyProperties=[],c.extend(c.ActionParam,c.ObjectPrototype),c.extend(c.ActionParam,c.ParamPrototype),c.extend(c.ActionParam,new c.EventPrototype(c.ActionParam.eventTypes)),c.ActionParamCollection=function(a,b){c.ObjectCollection.apply(this,[a,c.ActionParam]),this.__type="Svidget.ActionParamCollection";this.parent=b},c.ActionParamCollection.prototype=new c.ObjectCollection,c.extend(c.ActionParamCollection,{create:function(a,b,d){if(null==a)return null;if(null!=this.getByName(a))return null;var e=new c.ActionParam(a,b,d);return e}},!0),c.EventDesc=function(a,b,d){this.__type="Svidget.EventDesc",b=b||{},d=d instanceof c.Widget?d:null;var e=this,f=new function(){this.writable=["description","enabled","external"],this.name=a,this.description=b.description,this.external=b.external!==!1,this.enabled=b.enabled!==!1,this.eventName="trigger",this.eventContainer=new c.EventContainer([this.eventName],e)};this.setup(f),f.eventContainer.registerBubbleCallback(c.EventDesc.eventTypes,d,d.eventBubble)},c.EventDesc.prototype={name:function(){var a=this.getPrivate("name");return a},attached:function(){this.getset("widget");return null!=this.widget&&this.widget instanceof c.Widget},enabled:function(a){var b=this.getset("enabled",a);return void 0!==a&&b?(this.trigger("change",{property:"enabled",value:a}),!0):b
},description:function(a){var b=this.getset("description",a);return void 0!==a&&b?(this.trigger("change",{property:"description",value:a}),!0):b},external:function(a){var b=this.getset("external",a);return void 0!==a&&b?(this.trigger("change",{property:"public",value:a}),!0):b},eventName:function(){return this.getPrivate("eventName")},eventContainer:function(){return this.getset("eventContainer")},on:function(a,b,d,e){c.isFunction(a)&&(e=a,a=this.eventName()),this.eventContainer().on(a,b,d,e)},ontrigger:function(a,b,c){this.eventContainer().on(this.eventName(),a,b,c)},ondeclaredtrigger:function(a){return this.ontrigger(null,c.declaredHandlerName,a)},off:function(a,b){c.isFunction(a)&&(b=a,a=this.eventName()),this.eventContainer().off(a,b)},offtrigger:function(a){this.eventContainer().off(this.eventName(),a)},offdeclaredtrigger:function(){return this.offtrigger(c.declaredHandlerName)},onchange:function(a,b,c){return this.on("change",a,b,c)},ondeclaredchange:function(a){return this.onchange(null,c.declaredHandlerName,a)},offchange:function(a){this.off("change",a)},offdeclaredchange:function(){return this.offchange(c.declaredHandlerName)},trigger:function(a,b){this.enabled()&&(void 0===b&&(b=a,a=this.eventName()),this.eventContainer().trigger(a,b))},triggerEvent:function(a){this.trigger(this.eventName(),a)},toTransport:function(){var a={name:this.name(),description:this.description(),external:this.external(),enabled:this.enabled()};return a},toString:function(){return'[Svidget.EventDesc { name: "'+this.name+'" }]'}},c.EventDesc.eventTypes=["trigger","change"],c.EventDesc.optionProperties=["external","enabled","description"],c.EventDesc.allProxyProperties=["name","external","enabled","description","eventContainer"],c.EventDesc.writableProxyProperties=[],c.extend(c.EventDesc,c.ObjectPrototype),c.EventDescCollection=function(a,b){c.ObjectCollection.apply(this,[a,c.EventDesc]),this.__type="Svidget.EventDescCollection";this.parent=b},c.EventDescCollection.prototype=new c.ObjectCollection,c.extend(c.EventDescCollection,{create:function(a,b,d){if(null==a)return null;if(null!=this.getByName(a))return null;var e=new c.EventDesc(a,b,d);return e}},!0),c.Param=function(a,b,d,e){this.__type="Svidget.Param",d=d||{},e=e instanceof c.Widget?e:null;var f=new function(){this.writable=["binding","enabled","type","subtype","value","description","defvalue","typedata","coerce"],this.name=a,this.shortname=d.shortname,this.description=d.description,this.enabled=d.enabled!==!1,this.type=d.type||"string",this.subtype=d.subtype||null,this.typedata=d.typedata||null,this.value=b,this.defvalue=d.defvalue,this.sanitizer=d.sanitizer||null,this.coerce=!!d.coerce,this.widget=e,this.binding=d.binding||null,this.bindingQuery=null};this.setup(f),f.bindingQuery=c.DOM.select(f.binding),f.sanitizerFunc=c.findFunction(f.sanitizer),this.valuePopulated=!1,this.registerBubbleCallback(c.Param.eventTypes,e,e.paramBubble)},c.Param.prototype={shortname:function(){var a=this.getPrivate("shortname");return a},attached:function(){this.getset("widget");return null!=this.widget&&this.widget instanceof c.Widget},enabled:function(a){var b=this.getset("enabled",a);return void 0!==a&&b?(this.trigger("change",{property:"enabled",value:a}),!0):b},value:function(a){var b=this.getset("value",a,this.validateValue);if(void 0===a||!b)return b;if(!this.enabled())return!1;var c=a;return this.getset("coerce")===!0&&(c=this.coerceValue(c)),c=this.applySanitizer(c),this.setPrivate("value",c),this.applyBinding(c),this.trigger("valuechange",{value:c}),this.trigger("set",{value:c}),!0},serializedValue:function(){var a=this.value();return c.Conversion.toString(a)},coerce:function(a){var b=this.getset("coerce",a);return void 0!==a&&b?(this.trigger("change",{property:"coerce",value:a}),!0):b},binding:function(a){a=void 0!==a?a+"":void 0;var b=this.getset("binding",a);return void 0!==a&&b?(this.getset("bindingQuery",c.DOM.select(a)),this.trigger("change",{property:"binding",value:a}),!0):b},bindingQuery:function(){return this.getset("bindingQuery")},sanitizer:function(a){if(void 0!==a){"function"!=typeof a&&(a+="");var b=c.findFunction(a);this.getset("sanitizerFunc",b)}var d=this.getset("sanitizer",a);return void 0!==bind&&d?(this.trigger("change",{property:"sanitizer",value:val}),!0):d},sanitizerFunc:function(){var a=this.getset("sanitizer"),b=c.findFunction(a);return b},applySanitizer:function(a){var b=this.sanitizerFunc();if(!b)return a;var c=b.call(null,this,a);return void 0===c?a:c},validateValue:function(){return!0},coerceValue:function(a){return c.convert(a,this.type(),this.subtype(),this.typedata())},applyBinding:function(a){var b=this.bindingQuery();null!=b&&b.setValue(a)},onchange:function(a,b,c){return this.on("change",a,b,c)},ondeclaredchange:function(a){return this.onchange(null,c.declaredHandlerName,a)},offchange:function(a){this.off("change",a)},offdeclaredchange:function(){return this.offchange(c.declaredHandlerName)},onset:function(a,b,c){return this.on("set",a,b,c)},ondeclaredset:function(a){return this.onset(null,c.declaredHandlerName,a)},offset:function(a){return this.off("set",a)},offdeclaredset:function(){return this.offset(c.declaredHandlerName)},toTransport:function(){var a={name:this.name(),shortname:this.shortname(),enabled:this.enabled(),type:this.type(),subtype:this.subtype(),value:this.value()};return a},toString:function(){return'[Svidget.Param { name: "'+this.name+'" }]'}},c.Param.eventTypes=["change","set"],c.Param.optionProperties=["type","subtype","binding","sanitizer","enabled","shortname","defvalue","typedata","coerce"],c.Param.allProxyProperties=["name","value","type","subtype","enabled","shortname","defvalue","typedata","coerce"],c.Param.writableProxyProperties=["value"],c.extend(c.Param,c.ObjectPrototype),c.extend(c.Param,c.ParamPrototype),c.extend(c.Param,new c.EventPrototype(c.Param.eventTypes)),c.ParamCollection=function(a,b){c.ObjectCollection.apply(this,[a,c.Param]),this.__type="Svidget.ParamCollection";this.parent=b},c.ParamCollection.prototype=new c.ObjectCollection,c.extend(c.ParamCollection,{create:function(a,b,d,e){if(null==a)return null;if(null!=this.getByName(a))return null;var f=new c.Param(a,b,d,e);return f}},!0),c.Widget=function(){this.__type="Svidget.Widget";var a=this,b=new function(){this.writable=["id","enabled","started","connected","populatedFromPage"],this.params=new c.ParamCollection([],a),this.actions=new c.ActionCollection([],a),this.events=new c.EventDescCollection([],a),this.enabled=!0,this.connected=!1,this.started=!1,this.populatedFromPage=!1,this.id=null,this.page=null,this.parentElement=null};this.setup(b),this.wireCollectionAddRemoveHandlers(b.params,a.paramAdded,a.paramRemoved),this.wireCollectionAddRemoveHandlers(b.actions,a.actionAdded,a.actionRemoved),this.wireCollectionAddRemoveHandlers(b.events,a.eventAdded,a.eventRemoved),this._init()},c.Widget.prototype={_init:function(){},start:function(){this.getset("started",!0)},connect:function(a){this.connected()||(this.getset("id",a),this.getset("connected",!0))},setPopulatedFromPage:function(){this.getset("populatedFromPage",!0),this.trigger("pagepopulate",this)},updateParentElement:function(){},params:function(a){var b=this.getset("params");return this.select(b,a)},param:function(a){var b=this.getset("params"),c=this.selectFirst(b,a);return c},addParam:function(a,b,c){return this.params().add(a,b,c,this)},removeParam:function(a){return this.params().remove(a)},paramAdded:function(a){c.log("widget: param added: "+a.name()),this.trigger("paramadd",a),svidget.signalParamAdded(a)},paramRemoved:function(a){c.log("widget: param removed: "+a.name()),this.trigger("paramremove",a.name()),svidget.signalParamRemoved(a.name())},paramBubble:function(a,b,c){"change"==a&&this.paramChanged(c,b.value),("valuechange"==a||"set"==a)&&this.paramSet(c,b.value)},paramChanged:function(a,b){this.trigger("paramchange",b,a),svidget.signalParamChanged(a,b)},paramSet:function(a,b){this.trigger("paramset",b,a),this.trigger("paramvaluechange",b,a),svidget.signalParamSet(a,b)},actions:function(a){var b=this.getset("actions");return this.select(b,a)},action:function(a){var b=this.getset("actions"),c=this.selectFirst(b,a);return c},addAction:function(a,b){var d=this.actions().add(a,b,this);if(null==d)return d;if(null==b||null==b.params||!c.isArray(b.params))return d;for(var e=0;e<b.params.length;e++){var f=b.params[e];null!=f&&null!=f.name&&d.addParam(f.name,f)}},removeAction:function(a){return this.actions().remove(a)},actionAdded:function(a){c.log("widget: action added: "+a.name()),this.trigger("actionadd",a),svidget.signalActionAdded(a)},actionRemoved:function(a){c.log("widget: action removed: "+a.name()),this.trigger("actionremove",a.name()),svidget.signalActionRemoved(a.name())},actionBubble:function(a,b,c){"invoke"==a&&this.actionInvoked(c,b.value),"change"==a&&this.actionChanged(c,b.value),"paramchange"==a&&this.actionParamChanged(c,b.target,b.value),"paramadd"==a&&this.actionParamAdded(c,b.value),"paramremove"==a&&this.actionParamRemoved(c,b.value)},actionInvoked:function(a,b){this.trigger("actioninvoke",b,a),svidget.signalActionInvoked(a,b)},actionChanged:function(a,b){this.trigger("actionchange",b,a),svidget.signalActionChanged(a,b)},actionParamChanged:function(a,b,c){this.trigger("actionparamchange",c,b),svidget.signalActionParamChanged(b,a,c)},actionParamAdded:function(a,b){this.trigger("actionparamadd",b,a),svidget.signalActionParamAdded(b,a.name())},actionParamRemoved:function(a,b){this.trigger("actionparamremove",b,a),svidget.signalActionParamRemoved(b,a.name())},events:function(a){var b=this.getset("events");return this.select(b,a)},event:function(a){var b=this.getset("events"),c=this.selectFirst(b,a);return c},addEvent:function(a,b){return this.events().add(a,b,this)},removeEvent:function(a){return this.events().remove(a)},eventAdded:function(a){c.log("widget: event added: "+a.name()),this.trigger("eventadd",a),svidget.signalEventAdded(a)},eventRemoved:function(a){c.log("widget: event removed: "+a.name()),this.trigger("eventremove",a.name()),svidget.signalEventRemoved(a.name())},eventBubble:function(a,b,c){"trigger"==a&&this.eventTrigger(c,b),"change"==a&&this.eventChanged(c,b.value)},eventTrigger:function(a,b){c.log("widget: event trigger: "+a.name()),this.trigger("eventtrigger",b.value,a),svidget.signalEventTriggered(b.target,b.value)},eventChanged:function(a,b){this.trigger("eventchange",b,a),svidget.signalEventChanged(a,b)},id:function(){return this.getset("id")},enabled:function(a){var b=this.getset("enabled",a);return void 0!==a&&b?(this.trigger&&this.trigger("change",{property:"enabled",value:a}),!0):b},connected:function(){return this.getset("connected")},started:function(){var a=this.getset("started");return a},populatedFromPage:function(){return this.getset("populatedFromPage")},toTransport:function(){var a={id:this.id(),enabled:this.enabled(),params:this.toParamsTransport(),actions:this.toActionsTransport(),events:this.toEventsTransport()};return a},toParamsTransport:function(){var a=this.params(),b=a.select(function(a){return a.toTransport()}).toArray();return b},toActionsTransport:function(){var a=this.actions(),b=a.select(function(a){return a.toTransport()}).toArray();return b},toEventsTransport:function(){var a=this.events(),b=a.select(function(a){return a.toTransport()}).toArray();return b},onparamadd:function(a,b,c){return this.on("paramadd",a,b,c)},ondeclaredparamadd:function(a){return this.onparamadd(null,c.declaredHandlerName,a)},offparamadd:function(a){return this.off("paramadd",a)},offdeclaredparamadd:function(){return this.offparamadd(c.declaredHandlerName)},onparamremove:function(a,b,c){return this.on("paramremove",a,b,c)},ondeclaredparamremove:function(a){return this.onparamremove(null,c.declaredHandlerName,a)},offparamremove:function(a){return this.off("paramremove",a)},offdeclaredparamremove:function(){return this.offparamremove(c.declaredHandlerName)},onparamchange:function(a,b,c){return this.on("paramchange",a,b,c)},offparamchange:function(a){return this.off("paramchange",a)},onparamset:function(a,b,c){return this.on("paramset",a,b,c)},offparamset:function(a){return this.off("paramset",a)},onactionadd:function(a,b,c){return this.on("actionadd",a,b,c)},ondeclaredactionadd:function(a){return this.onactionadd(null,c.declaredHandlerName,a)},offactionadd:function(a){return this.off("actionadd",a)},offdeclaredactionadd:function(){return this.offactionadd(c.declaredHandlerName)},onactionremove:function(a,b,c){return this.on("actionremove",a,b,c)},ondeclaredactionremove:function(a){return this.onactionremove(null,c.declaredHandlerName,a)},offactionremove:function(a){return this.off("actionremove",a)},offdeclaredactionremove:function(){return this.offactionremove(c.declaredHandlerName)},onactionchange:function(a,b,c){return this.on("actionchange",a,b,c)},offactionchange:function(a){return this.off("actionchange",a)},onactioninvoke:function(a,b,c){return this.on("actioninvoke",a,b,c)},offactioninvoke:function(a){return this.off("actioninvoke",a)},oneventadd:function(a,b,c){return this.on("eventadd",a,b,c)},ondeclaredeventadd:function(a){return this.oneventadd(null,c.declaredHandlerName,a)},offeventadd:function(a){return this.off("eventadd",a)},offdeclaredeventadd:function(){return this.offeventadd(c.declaredHandlerName)},oneventremove:function(a,b,c){return this.on("eventremove",a,b,c)},ondeclaredeventremove:function(a){return this.oneventremove(null,c.declaredHandlerName,a)},offeventremove:function(a){return this.off("eventremove",a)},offdeclaredeventremove:function(){return this.offeventremove(c.declaredHandlerName)},oneventchange:function(a,b,c){return this.on("eventchange",a,b,c)},offeventchange:function(a){return this.off("eventchange",a)},oneventtrigger:function(a,b,c){return this.on("eventtrigger",a,b,c)},offeventtrigger:function(a){return this.off("eventtrigger",a)},onpagepopulate:function(a,b,c){return this.on("pagepopulate",a,b,c)},offpagepopulate:function(a){return this.off("pagepopulate",a)},toString:function(){return'[Svidget.Widget { id: "'+this.id()+'" }]'}},c.Widget.eventTypes=["change","pagepopulate","paramvaluechange","paramchange","paramadd","paramremove","actioninvoke","actionchange","actionadd","actionremove","eventtrigger","eventadd","eventremove"],c.extend(c.Widget,c.ObjectPrototype),c.extend(c.Widget,new c.EventPrototype(c.Widget.eventTypes)),c.Proxy=function(a,b,d,e,f){function g(a){return function(b){return this.getsetProp(a,b)}}this.__type="Svidget.Proxy";var h=this;b=b||{};var i=new c.Collection(c.isArray(d)?d:null),j=new c.Collection(c.isArray(e)?e:null);j=j.where(function(a){return i.contains(a)});var k={writable:j.toArray(),propertyChangeFuncs:new c.Collection,eventContainer:new c.EventContainer(f,h),parent:a,connected:null==b.connected?!0:!!b.connected};this.setup(k);for(var l in b)void 0===k[l]&&(k[l]=b[l]);for(var m=0;m<i.length;m++){var n=i[m]+"";n.length>0&&(this[n]=g(n))}},c.Proxy.prototype={parent:function(){var a=this.getPrivate("parent");return a},propertyChangeFuncs:function(){return this.getPrivate("propertyChangeFuncs")},connected:function(){return this.getPrivate("connected")},getsetProp:function(a,b){var c=this.getset(a,b);return void 0!==b&&c?(this.handlePropertyChange(a,b),!0):c},handlePropertyChange:function(){},triggerPropertyChange:function(a,b){var c=this.propertyChangeFuncs(),d=this;c.each(function(c){c(d,a,b)})},notifyPropertyChange:function(a,b){null!=a&&(this.getset(a,b),this.triggerFromWidget("change",{property:a,value:b},this))},refreshProperties:function(a){for(var b in a){var c=this.getPrivate(b);null!=c&&this.setPrivate(b,a[b])}},connect:function(){this.setPrivate("connected",!0)},onPropertyChange:function(a){var b=this.propertyChangeFuncs();return b.add(a),!0},offPropertyChange:function(a){var b=this.propertyChangeFuncs();return b.remove(a)},eventContainer:function(){return this.getPrivate("eventContainer")},on:function(a,b,c,d){this.eventContainer().on(a,b,c,d)},off:function(a,b){this.eventContainer().off(a,b)},triggerFromWidget:function(a,b,c){this.eventContainer().trigger(a,b,c)},registerBubbleCallback:function(a,b,c){this.eventContainer().registerBubbleCallback(a,b,c)}},c.extend(c.Proxy,c.ObjectPrototype),c.ActionProxy=function(a,b,d){var e=this,f={name:a,params:new c.ActionParamProxyCollection([],e)};b=b||{};for(var g in b)void 0===f[g]&&(f[g]=b[g]);d&&(d=d instanceof c.WidgetReference?d:null),c.Proxy.apply(this,[d,f,c.Action.allProxyProperties,c.Action.writableProxyProperties]),this.__type="Svidget.ActionProxy",this.registerBubbleCallback(c.Action.eventTypes,d,d.actionProxyBubble),this.wireCollectionAddRemoveHandlers(f.params,e.paramAdded,e.paramRemoved)},c.ActionProxy.prototype=new c.Proxy,c.extend(c.ActionProxy,{invoke:function(){if(!this.canInvoke())return!1;var a=c.array(arguments);return svidget.signalActionInvoke(this.parent(),this,a),!0},canInvoke:function(){return this.getset("external")},invokeFromWidget:function(a){this.triggerFromWidget("invoke",{returnValue:a},this)},params:function(a){var b=this.getset("params");return this.select(b,a)},param:function(a){var b=this.getset("params"),c=this.selectFirst(b,a);return c},addParam:function(a,b){return this.params().add(a,b,this)},removeParam:function(a){return this.params().remove(a)},paramProxyBubble:function(a,b,c){"change"==a&&this.paramChanged(c,b.value)},paramChanged:function(a,b){this.triggerFromWidget("paramchange",b,a)},paramAdded:function(a){this.triggerFromWidget("paramadd",a)},paramRemoved:function(a){this.triggerFromWidget("paramremove",a.name())},onchange:function(a,b,c){return this.on("change",a,b,c)},offchange:function(a){this.off("change",a)},oninvoke:function(a,b,c){return this.on("invoke",a,b,c)},offinvoke:function(a){return this.off("invoke",a)},onparamadd:function(a,b,c){return this.on("paramadd",a,b,c)},offparamadd:function(a){return this.off("paramadd",a)},onparamchange:function(a,b,c){return this.on("paramchange",a,b,c)},offparamchange:function(a){return this.off("paramchange",a)},onparamremove:function(a,b,c){return this.on("paramremove",a,b,c)},offparamremove:function(a){return this.off("paramremove",a)},toString:function(){return'[Svidget.ActionProxy { name: "'+this.name+'" }]'}},!0),c.ActionProxyCollection=function(a,b){c.ObjectCollection.apply(this,[a,c.ActionProxy]),this.__type="Svidget.ActionProxyCollection";this.parent=b},c.ActionProxyCollection.prototype=new c.ObjectCollection,c.extend(c.ActionProxyCollection,{create:function(a,b,d){if(null==a)return null;if(null!=this.getByName(a))return null;var e=new c.ActionProxy(a,b,d);return e}},!0),c.ActionParamProxy=function(a,b,d){var e={name:a};b=b||{};for(var f in b)void 0===e[f]&&(e[f]=b[f]);d&&(d=d instanceof c.ActionProxy?d:null),c.Proxy.apply(this,[d,e,c.ActionParam.allProxyProperties,c.ActionParam.writableProxyProperties]),this.__type="Svidget.ActionParamProxy",this.registerBubbleCallback(c.ActionParam.eventTypes,d,d.paramProxyBubble)},c.ActionParamProxy.prototype=new c.Proxy,c.extend(c.ActionParamProxy,{toString:function(){return'[Svidget.ActionParamProxy { name: "'+this.name+'" }]'}},!0),c.ActionParamProxyCollection=function(a,b){c.ObjectCollection.apply(this,[a,c.ActionParamProxy]),this.__type="Svidget.ActionParamProxyCollection";this.parent=b},c.ActionParamProxyCollection.prototype=new c.ObjectCollection,c.extend(c.ActionParamProxyCollection,{create:function(a,b,d){if(null==a)return null;if(null!=this.getByName(a))return null;var e=new c.ActionParamProxy(a,b,d);return e}},!0),c.EventDescProxy=function(a,b,d){var e="trigger",f={name:a,eventName:e};b=b||{};for(var g in b)void 0===f[g]&&(f[g]=b[g]);d&&(d=d instanceof c.WidgetReference?d:null),c.Proxy.apply(this,[d,f,c.EventDesc.allProxyProperties,c.EventDesc.writableProxyProperties]),this.__type="Svidget.EventDescProxy",this.registerBubbleCallback(c.EventDesc.eventTypes,d,d.eventProxyBubble)},c.EventDescProxy.prototype=new c.Proxy,c.extend(c.EventDescProxy,{triggerEventName:function(){return this.getPrivate("eventName")},on:function(a,b,d,e){c.isFunction(a)&&(e=a,a=this.triggerEventName()),this.eventContainer().on(a,b,d,e)},ontrigger:function(a,b,c){this.eventContainer().on(this.triggerEventName(),a,b,c)},off:function(a,b){c.isFunction(a)&&(b=a,a=this.triggerEventName()),this.eventContainer().off(a,b)},offtrigger:function(a){this.eventContainer().off(this.triggerEventName(),a)},onchange:function(a,b,c){return this.on("change",a,b,c)},offchange:function(a){this.off("change",a)},trigger:function(a){return this.canTrigger()?(svidget.signalEventTrigger(this.parent(),this,a),!0):!1},canTrigger:function(){return this.getset("external")},triggerEventFromWidget:function(a){this.eventContainer().trigger(this.triggerEventName(),a)},toString:function(){return'[Svidget.EventDescProxy { name: "'+this.name+'" }]'}},!0),c.EventDescProxyCollection=function(a,b){c.ObjectCollection.apply(this,[a,c.EventDescProxy]),this.__type="Svidget.EventDescProxyCollection";this.parent=b},c.EventDescProxyCollection.prototype=new c.ObjectCollection,c.extend(c.EventDescProxyCollection,{create:function(a,b,d){if(null==a)return null;if(null!=this.getByName(a))return null;var e=new c.EventDescProxy(a,b,d);return e}},!0),c.ParamProxy=function(a,b,d,e){var f={name:a,value:b};d=d||{};for(var g in d)f[g]=d[g];e&&(e=e instanceof c.WidgetReference?e:null),c.Proxy.apply(this,[e,f,c.Param.allProxyProperties,c.Param.writableProxyProperties]),this.__type="Svidget.ParamProxy",this.registerBubbleCallback(c.Param.eventTypes,e,e.paramProxyBubble)},c.ParamProxy.prototype=new c.Proxy,c.extend(c.ParamProxy,{handlePropertyChange:function(a,b){"value"==a&&(this.parent().updateParamValue(this.name(),b),svidget.signalPropertyChange(this.parent(),this,"param",a,b))},notifyValueChange:function(a){this.getset("value",a),this.triggerFromWidget("valuechange",{value:a},this),this.triggerFromWidget("set",{value:a},this)},serializedValue:function(){var a=this.value();return c.Conversion.toString(a)},onchange:function(a,b,c){return this.on("change",a,b,c)},offchange:function(a){this.off("change",a)},onset:function(a,b,c){return this.on("set",a,b,c)},offset:function(a){return this.off("set",a)},toString:function(){return'[Svidget.ParamProxy { name: "'+this.name+'" }]'}},!0),c.ParamProxyCollection=function(a,b){c.ObjectCollection.apply(this,[a,c.ParamProxy]),this.__type="Svidget.ParamProxyCollection";this.parent=b},c.ParamProxyCollection.prototype=new c.ObjectCollection,c.extend(c.ParamProxyCollection,{create:function(a,b,d,e){if(null==a)return null;if(null!=this.getByName(a))return null;var f=new c.ParamProxy(a,b,d,e);return f}},!0),c.WidgetReference=function(a,b,d,e,f,g){function h(a){if(null!=a)for(var b in a)this.addParamProxy(b,a[b],{connected:!1})}this.__type="Svidget.WidgetReference";var i=this,j=new function(){this.writable=["enabled","started","populated","paramValues"],this.params=new c.ParamProxyCollection([],i),this.actions=new c.ActionProxyCollection([],i),this.events=new c.EventDescProxyCollection([],i),this.eventContainer=new c.EventContainer(c.Widget.eventTypes,i),this.paramValues=b,this.enabled=!0,this.started=!1,this.populated=!1,this.connected=!!f,this.crossdomain=!!g,this.state="declared",this.id=a,this.element=e,this.declaringElement=d,this.url=d.getAttribute("data")};this.setup(j),this.setElement=function(a){return null!=j.element?!1:c.DOM.isElement(a)?(j.element=a,void(this.setElement=null)):!1},h.call(i,b),d.widgetReference=this,this.wireCollectionAddRemoveHandlers(j.params,i.paramProxyAdded,i.paramProxyRemoved),this.wireCollectionAddRemoveHandlers(j.actions,i.actionProxyAdded,i.actionProxyRemoved),this.wireCollectionAddRemoveHandlers(j.events,i.eventProxyAdded,i.eventProxyRemoved)},c.WidgetReference.prototype={id:function(){var a=this.getset("id");return a},name:function(){return this.id()},enabled:function(){var a=this.getset("enabled");return a},url:function(){var a=this.getset("url");return a},element:function(){var a=this.getset("element");return a},declaringElement:function(){var a=this.getset("declaringElement");return a},root:function(){if(this.isCrossDomain())return null;var a=this.document(),b=a.parentWindow||a.defaultView;return b.svidget},window:function(){var a=this.element();return null==a?null:a.contentWindow},document:function(){var a=this.element();return c.DOM.getDocument(a)},connected:function(a){var b=this.getset("connected",a);return void 0!==a&&b?!0:b},crossdomain:function(a){var b=this.getset("crossdomain",a);return void 0!==a&&b?!0:b},params:function(a){var b=this.getset("params");return this.select(b,a)},param:function(a){var b=this.getset("params"),c=this.selectFirst(b,a);return c},actions:function(a){var b=this.getset("actions");return this.select(b,a)},action:function(a){var b=this.getset("actions"),c=this.selectFirst(b,a);return c},events:function(a){var b=this.getset("events");return this.select(b,a)},event:function(a){var b=this.getset("events"),c=this.selectFirst(b,a);return c},paramValues:function(){var a=this.getset("paramValues");return a},addParamProxy:function(a,b,c){return this.params().add(a,b,c,this)},removeParamProxy:function(a){return this.params().remove(a)},refreshParamProxy:function(a,b,c){var d=this.param(a);return null==d?this.params().add(a,b,c,this):(d.refreshProperties(c),d)},updateParamValue:function(a,b){var c=this.getset("paramValues");c=c||{},c[a]=b,this.getset("paramValues",c)},paramProxyAdded:function(a){c.log("page: param proxy added: "+a.name()),this.triggerFromWidget("paramadd",a)},paramProxyRemoved:function(a){c.log("page: param proxy removed: "+a.name()),this.triggerFromWidget("paramremove",a.name())},paramProxyBubble:function(a,b,d){c.log("page: param proxy bubble: "+d.name()),"change"==a&&this.paramProxyChanged(d,b.value),"valuechange"==a&&this.paramProxyValueChanged(d,b.value)},paramProxyChanged:function(a,b){c.log("page: param proxy change: "+a.name()),this.triggerFromWidget("paramchange",b,a)},paramProxyValueChanged:function(a,b){c.log("page: param proxy value change: "+a.name()),this.triggerFromWidget("paramvaluechange",b,a)},addActionProxy:function(a,b){return this.actions().add(a,b,this)},removeActionProxy:function(a){return this.actions().remove(a)},actionProxyAdded:function(a){c.log("page: action proxy added: "+a.name()),this.triggerFromWidget("actionadd",a)},actionProxyRemoved:function(a){c.log("page: action proxy removed: "+a.name()),this.triggerFromWidget("actionremove",a.name())},actionProxyBubble:function(a,b,d){c.log("page: action proxy bubble: "+d.name()),"invoke"==a&&this.actionProxyInvoked(d,b.value),"change"==a&&this.actionProxyChanged(d,b.value),"paramchange"==a&&this.actionParamProxyChanged(d,b.target,b.value),"paramadd"==a&&this.actionParamProxyAdded(d,b.value),"paramremove"==a&&this.actionParamProxyRemoved(d,b.value)},actionProxyInvoked:function(a,b){this.triggerFromWidget("actioninvoke",b,a)},actionProxyChanged:function(a,b){this.triggerFromWidget("actionchange",b,a)},actionParamProxyAdded:function(a,b){this.triggerFromWidget("actionparamadd",b,a)},actionParamProxyRemoved:function(a,b){this.triggerFromWidget("actionparamremove",b,a)},actionParamProxyChanged:function(a,b,c){this.triggerFromWidget("actionparamchange",c,b)},addEventProxy:function(a,b){return this.events().add(a,b,this)},removeEventProxy:function(a){return this.events().remove(a)},eventProxyAdded:function(a){c.log("page: event proxy added: "+a.name()),this.triggerFromWidget("eventadd",a)},eventProxyRemoved:function(a){c.log("page: event proxy removed: "+a.name()),this.triggerFromWidget("eventremove",a.name())},eventProxyBubble:function(a,b,d){c.log("page: event proxy bubble: "+d.name()),"trigger"==a&&this.eventProxyTriggered(d,b),"change"==a&&this.eventProxyChanged(d,b.value)},eventProxyTriggered:function(a,b){c.log("page: event proxy trigger: "+a.name()),this.triggerFromWidget("eventtrigger",b.value,a)},eventProxyChanged:function(a,b){c.log("page: event proxy change: "+a.name()),this.triggerFromWidget("eventchange",b,a)},eventContainer:function(){return this.getPrivate("eventContainer")},on:function(a,b,c,d){this.eventContainer().on(a,b,c,d)},off:function(a,b){this.eventContainer().off(a,b)},triggerFromWidget:function(a,b,c){this.eventContainer().trigger(a,b,c)},hasElement:function(){return null!=this.element()},isAttached:function(){var a=this.element();return null!=a&&null!=a.parentNode},isCrossDomain:function(){return this.element()!==this.declaringElement()},started:function(){var a=this.getset("started");return a},populated:function(){var a=this.getset("populated");return a},start:function(){this.getset("started",!0)},populate:function(a){this.populated()||(this.enabled(a.enabled),this._populateParams(a.params),this._populateActions(a.actions),this._populateEvents(a.events),this.getset("populated",!0))},_populateParams:function(a){if(a&&c.isArray(a))for(var b=0;b<a.length;b++){var d=a[b],e=this.refreshParamProxy(d.name,d.value,d);e.connect()}},_populateActions:function(a){if(a&&c.isArray(a))for(var b=0;b<a.length;b++){var d=a[b],e=this.addActionProxy(d.name,d);this._populateActionParams(d.params,e)}},_populateActionParams:function(a,b){if(a&&c.isArray(a))for(var d=0;d<a.length;d++){var e=a[d];b.addParam(e.name,e)}},_populateEvents:function(a){if(a&&c.isArray(a))for(var b=0;b<a.length;b++){var d=a[b];this.addEventProxy(d.name,d)}}},c.extend(c.WidgetReference,c.ObjectPrototype),c.Root.PagePrototype={initInternal:function(){this.idSeed=1,d._svidget="page",this.connected(!0),Object.defineProperty(this,"$",c.readOnlyProperty(null))},readyPage:function(){c.log("page: readyPage"),this.loadPageWidgets()},loadPageWidgets:function(){var a=this,b=this.findAllWidgetElements();b.each(function(b){a.loadPageWidget(b)})},loadPageWidget:function(a,b){var c=this.createWidgetReference(a,b);return this.addWidget(c),this.readyWidgetReference(c,a),c},createWidgetReference:function(a,b){var d;d=void 0===b?this.parseParamElements(a):b;var e="false"!=a.getAttribute("data-connected"),f="true"==a.getAttribute("data-crossdomain"),g=this.getWidgetIDForElement(a),h=this.resolveCoreWidgetElement(a,null,f),i=new c.WidgetReference(g,d,a,h,e,f);return i},readyWidgetReference:function(a,b){var c=a.element()||b;this.addWidgetLoadEvents(c,a)},addWidgetLoadEvents:function(a,b){c.log("page: addWidgetLoadEvents: id = "+a.id+", tag = "+a.tagName);var d=c.wrap(this.finishPageWidget,this),e=function(){d(b)};b._waitingForDOM=!0,c.DOM.on(a,"load",e)},finishPageWidget:function(a){c.log("page: finishPageWidget: id = "+a.id()),a._waitingForDOM=!1;var b=this.ensureCoreElementResolved(a);null!=b&&b!=a.declaringElement()?this.readyWidgetReference(a,a.element()):this.ensureWidgetStarted(a)},ensureCoreElementResolved:function(a){if(a.hasElement())return null;var b=this.resolveCoreWidgetElement(a.declaringElement(),a,a.crossdomain());return null!=b?(c.log("page: CoreElementCreated: "+b.tagName+" id:"+a.id()),a.setElement(b),b):null},ensureWidgetStarted:function(a){a.hasElement()&&!a.started()&&c.DOM.isElementDocumentReady(a.element())&&this.signalStart(a,a.paramValues())},resolveCoreWidgetElement:function(a,b,d){var e=c.DOM.getDocument(a);if(null===e&&!d)return null;var f=null,g=a;return(void 0===e||d)&&(f=this.buildIFrameElement(a),a.parentNode.insertBefore(f,a),this.disableAndHide(a),g=f),g},waitForWidgets:function(){setTimeout(c.wrap(this.checkUnfinishedWidgetReferences,this),50)},checkUnfinishedWidgetReferences:function(){if(!this.allWidgetsStarted){c.log("page: checkUnfinishedWidgetReferences");var a=this,b=0;this.widgets().where(function(b){return a.needsFinishing(b)}).each(function(c){b++,a.finishPageWidget(c)}),this.waitForWidgets()}},needsFinishing:function(a){return a._waitingForDOM?!1:a.hasElement()&&a.started()||!c.DOM.isElementDocumentReady(a.declaringElement())?a.hasElement()&&a.isCrossDomain()&&!a.started()&&c.DOM.isElementDocumentReady(a.element())?!0:!1:!0},areAllWidgetsStarted:function(){return this.widgets().all(function(a){return a.started()})},disableAndHide:function(a){a.data="",c.DOM.disable(a),c.DOM.hide(a)
},getWidgetIDForElement:function(a){var b=a.id;return null!=b&&c.DOM.get(b)==a?b:this.newWidgetID()},newWidgetID:function(){var a="_svidget_";void 0===this.idCounter&&(this.idCounter=1);for(var b,d=this.idCounter;;){var b=a+d;if(d++,null==c.DOM.get(b))break}return this.idCounter=d,b},buildIFrameElement:function(a){var b=e.createElement("iframe"),d=c.DOM.wrap(a);return d.attributes().each(function(a){"data"==a.name()?b.setAttribute("src",a.value()):"id"==a.name()?b.setAttribute("id",a.value()+"_frame"):b.setAttribute(a.name(),a.value())}),b},buildObjectElement:function(a,b){if(!e.createElement)return null;var c=e.createElement("object");c.setAttribute("role","svidget"),c.setAttribute("data",a.url),a.id&&c.setAttribute("id",a.id),a.width&&c.setAttribute("width",a.width),a.height&&c.setAttribute("height",a.height),void 0!==a.connected&&c.setAttribute("data-connected",a.connected),void 0!==a.crossdomain&&c.setAttribute("data-crossdomain",a.crossdomain);for(var d in b){var f=e.createElement("param");f.setAttribute("name",d)}return c},createObjectElement:function(a,b,c){var d=this.buildObjectElement(b,c);return a.appendChild(d),d},populateWidgetReference:function(a,b){c.log("page: populateWidgetReference"),a.populated()||a.populate(b)},findAllWidgetElements:function(){var a=c.DOM.getByName("object",!0),b=a.where(function(a){return"svidget"==c.DOM.attrValue(a,"role")});return b},parseParamElements:function(a){for(var b=c.DOM.getChildrenByName(a,"param",!0),d={},e=0;e<b.length;e++){var f=b[e].getAttribute("name");null!=f&&f.length>0&&(d[f]=b[e].getAttribute("value"))}return d},getWidget:function(a){if(null==a)return null;var b=this.widgets();return b.first(function(b){return b.id()===a})},addWidget:function(a){return this.widgets().contains(a)?!1:(this.widgets().add(a),!0)},load:function(a,b,d,e){var f=c.DOM.selectElement(a);if(null==f)return null;var g=null;if("string"==typeof b)g={url:b};else{if(null==b)return null;g=b}if(null!=g.url){this.allWidgetsStarted=!1;var h=this.createObjectElement(f,g,d),i=this.loadPageWidget(h,d);return e&&"function"==typeof e&&e(i),i}},widgets:function(a){var b=this.getWidgets();return this.select(b,a)},widget:function(a){var b=this.getWidgets(),c=this.selectFirst(b,a);return c},getWidgets:function(){var a=this.getset("widgets");return null==a&&(a=new c.ObjectCollection(null,c.WidgetReference),this.getset("widgets",a)),a},triggerWidgetEvent:function(a,b,c){var d=a.event(b);null!=d&&d.triggerFromWidget(c)},receiveFromWidget:function(a,b,d){c.log("page: receiveFromWidget {name: "+a+", widgetID: "+d+"}");var e=this.getWidget(d);switch(a){case"paramadded":this.handleReceiveWidgetParamAdded(e,b);break;case"paramremoved":this.handleReceiveWidgetParamRemoved(e,b);break;case"paramchanged":this.handleReceiveWidgetParamChanged(e,b);break;case"paramset":this.handleReceiveWidgetParamSet(e,b);break;case"actionadded":this.handleReceiveWidgetActionAdded(e,b);break;case"actionremoved":this.handleReceiveWidgetActionRemoved(e,b);break;case"actionchanged":this.handleReceiveWidgetActionChanged(e,b);break;case"actioninvoked":this.handleReceiveWidgetActionInvoked(e,b);break;case"actionparamadded":this.handleReceiveWidgetActionParamAdded(e,b);break;case"actionparamremoved":this.handleReceiveWidgetActionParamRemoved(e,b);break;case"actionparamchanged":this.handleReceiveWidgetActionParamChanged(e,b);break;case"eventadded":this.handleReceiveWidgetEventAdded(e,b);break;case"eventremoved":this.handleReceiveWidgetEventRemoved(e,b);break;case"eventchanged":this.handleReceiveWidgetEventChanged(e,b);break;case"eventtriggered":this.handleReceiveWidgetEventTriggered(e,b);break;case"startack":this.handleReceiveWidgetStartAck(e,b)}},signalStart:function(a,b){c.log("page: signalStart {id: "+a.id()+", url: "+a.url()+", tag: "+a.element().tagName+"}");var d={id:a.id(),params:b,connected:a.connected()};this.comm().signalWidget(a,"start",d)},signalPropertyChange:function(a,b,d,e,f){if(a.started()&&a.connected()){c.log("page: signalPropertyChange {id: "+a.id()+", type: "+d+"}");var g={type:d,name:b.name(),propertyName:e,value:f};this.comm().signalWidget(a,"propertychange",g)}},signalActionInvoke:function(a,b,d){if(a.started()&&a.connected()){c.log("page: signalActionInvoke {id: "+a.id()+", url: "+a.url()+"}");var e={action:b.name(),args:d};this.comm().signalWidget(a,"actioninvoke",e)}},signalEventTrigger:function(a,b,d){if(a.started()&&a.connected()){c.log("page: signalEventTrigger {id: "+a.id()+"}");var e={event:b.name(),data:d};this.comm().signalWidget(a,"eventtrigger",e)}},handleReceiveWidgetInitialized:function(){c.log("page: handleReceiveWidgetInitialized")},handleReceiveWidgetLoaded:function(a,b){return null==a?void this.checkUnfinishedWidgetReferences():void this.populateWidgetReference(a,b)},handleReceiveWidgetStartAck:function(a,b){c.log("page: handleReceiveWidgetStartAck {widget: "+a.id()+"}"),a.started()||(a.start(),this.populateWidgetReference(a,b),this.triggerWidgetLoad(a.id()),this.areAllWidgetsStarted()&&(this.allWidgetsStarted=!0,this.markLoaded()))},handleReceiveWidgetParamAdded:function(a,b){c.log("page: handleReceiveWidgetParamAdded {param: "+b.name+"}"),a.addParamProxy(b.name,b)},handleReceiveWidgetParamRemoved:function(a,b){c.log("page: handleReceiveWidgetParamRemoved {param: "+b+"}"),a.removeParamProxy(b)},handleReceiveWidgetParamChanged:function(a,b){c.log("page: handleReceiveWidgetParamChanged {param: "+b.name+"}");var d=a.param(b.name);null!=d&&d.notifyPropertyChange(b.property,b.value)},handleReceiveWidgetParamSet:function(a,b){c.log("page: handleReceiveWidgetParamSet {param: "+b.name+"}");var d=a.param(b.name);null!=d&&d.notifyValueChange(b.value)},handleReceiveWidgetActionAdded:function(a,b){c.log("page: handleReceiveWidgetActionAdded {action: "+b.name+"}"),a.addActionProxy(b.name,b)},handleReceiveWidgetActionRemoved:function(a,b){c.log("page: handleReceiveWidgetActionRemoved {action: "+b+"}"),a.removeActionProxy(b)},handleReceiveWidgetActionChanged:function(a,b){c.log("page: handleReceiveWidgetActionChanged {action: "+b.name+"}");var d=a.action(b.name);null!=d&&d.notifyPropertyChange(b.property,b.value)},handleReceiveWidgetActionInvoked:function(a,b){c.log("page: handleReceiveWidgetActionInvoked {action: "+b.name+"}");var d=a.action(b.name);null!=d&&d.invokeFromWidget(b.returnValue)},handleReceiveWidgetActionParamAdded:function(a,b){c.log("page: handleReceiveWidgetActionParamAdded {actionparam: "+b.name+"}");var d=a.action(b.actionName);null!=d&&d.addParam(b.name,b)},handleReceiveWidgetActionParamRemoved:function(a,b){c.log("page: handleReceiveWidgetActionParamRemoved {actionparam: "+b+"}");var d=a.action(b.actionName);null!=d&&d.removeParam(b.name)},handleReceiveWidgetActionParamChanged:function(a,b){c.log("page: handleReceiveWidgetActionParamChanged {actionparam: "+b.name+"}");var d=a.action(b.actionName);if(null!=d){var e=d.param(b.name);null!=e&&e.notifyPropertyChange(b.property,b.value)}},handleReceiveWidgetEventAdded:function(a,b){c.log("page: handleReceiveWidgetEventAdded {event: "+b.name+"}"),a.addEventProxy(b.name,b)},handleReceiveWidgetEventRemoved:function(a,b){c.log("page: handleReceiveWidgetEventRemoved {event: "+b+"}"),a.removeEventProxy(b)},handleReceiveWidgetEventChanged:function(a,b){c.log("page: handleReceiveWidgetEventChanged {event: "+b.name+"}");var d=a.event(b.name);null!=d&&d.notifyPropertyChange(b.property,b.value)},handleReceiveWidgetEventTriggered:function(a,b){c.log("page: handleReceiveWidgetEventTriggered {event: "+b.name+"}");var d=a.event(b.name);null!=d&&d.triggerEventFromWidget(b.value)}},c.Root.WidgetPrototype={initInternal:function(){this.loadCurrent(),d._svidget="widget"},readyWidget:function(){c.log("widget: readyWidget"),this.startWidget(),this.markLoaded()},loadCurrent:function(){var a=new c.Widget;this.setCurrent(a),this.setCurrent=null,Object.defineProperty(this,"$",c.readOnlyProperty(a))},startWidget:function(){var a=this.current();this.parseElements(),this.connected()?this.startWidgetConnected(a):this.startWidgetStandalone(a)},startWidgetStandalone:function(a){var b=this.getParamValuesFromQueryString();this.setParamValues(a,b,!0),a.start()},startWidgetConnected:function(a){null!=this.paramValues&&(this.setParamValues(this.paramValues),this.paramValues=null,a.setPopulatedFromPage()),a.start()},parseElements:function(){var a=this.getParamsElement();this.populateParams(a);var b=this.getActionsElement();this.populateActions(b);var c=this.getEventsElement();this.populateEvents(c)},getParamsElement:function(){return this.getSvidgetElement("params")},getActionsElement:function(){return this.getSvidgetElement("actions")},getEventsElement:function(){return this.getSvidgetElement("events")},getSvidgetElement:function(a){var b=c.DOM.getByNameSvidget(a,!0);return 0==b.length?null:b[0]},populateParams:function(a){if(null!=a){var b=this,d=this.current();this.populateElementObjects(a,function(a,c){var d=b.buildParam(a,c);null!=d&&c.addParam(d)}),this.wireDeclaredHandler(d,d.ondeclaredparamadd,c.DOM.attrValue(a,"onadd")),this.wireDeclaredHandler(d,d.ondeclaredparamremove,c.DOM.attrValue(a,"onremove"))}},buildParam:function(a,b){if(!this.isValidSvidgetElement(a,"param"))return null;var d=c.DOM.attrValue(a,"name");if(null==d)return null;var e=c.DOM.attrValue(a,"value"),f=this.buildOptions(a,c.Param.optionProperties),g=new c.Param(d,e,f,b);return this.wireDeclaredChangeHandler(g,c.DOM.attrValue(a,"onchange")),this.wireDeclaredSetHandler(g,c.DOM.attrValue(a,"onset")),g},populateActions:function(a){if(null!=a){var b=this,d=this.current();this.populateElementObjects(a,function(a,c){var d=b.buildAction(a,c);null!=d&&(c.addAction(d),b.populateActionParams(a,d))}),this.wireDeclaredHandler(d,d.ondeclaredactionadd,c.DOM.attrValue(a,"onadd")),this.wireDeclaredHandler(d,d.ondeclaredactionremove,c.DOM.attrValue(a,"onremove"))}},populateActionParams:function(a,b){if(null!=a){var c=this;this.populateElementObjects(a,function(a){var d=c.buildActionParam(a,b);null!=d&&b.addParam(d)})}},buildAction:function(a,b){if(!this.isValidSvidgetElement(a,"action"))return null;var d=c.DOM.attrValue(a,"name");if(null==d)return null;var e=this.buildOptions(a,c.Action.optionProperties),f=new c.Action(d,e,b);return this.wireDeclaredChangeHandler(f,c.DOM.attrValue(a,"onchange")),this.wireDeclaredInvokeHandler(f,c.DOM.attrValue(a,"oninvoke")),this.wireDeclaredParamAddHandler(f,c.DOM.attrValue(a,"onparamadd")),this.wireDeclaredParamRemoveHandler(f,c.DOM.attrValue(a,"onparamremove")),this.wireDeclaredParamChangeHandler(f,c.DOM.attrValue(a,"onparamchange")),f},buildActionParam:function(a,b){if(!this.isValidSvidgetElement(a,"actionparam"))return null;var d=c.DOM.attrValue(a,"name");if(null==d)return null;var e=this.buildOptions(a,c.ActionParam.optionProperties),f=new c.ActionParam(d,e,b);return this.wireDeclaredChangeHandler(f,c.DOM.attrValue(a,"onchange")),f},populateEvents:function(a){if(null!=a){var b=this,d=this.current();this.populateElementObjects(a,function(a,c){var d=b.buildEvent(a,c);null!=d&&c.addEvent(d)}),this.wireDeclaredHandler(d,d.ondeclaredeventadd,c.DOM.attrValue(a,"onadd")),this.wireDeclaredHandler(d,d.ondeclaredeventremove,c.DOM.attrValue(a,"onremove"))}},buildEvent:function(a,b){if(!this.isValidSvidgetElement(a,"event"))return null;var d=c.DOM.attrValue(a,"name");if(null==d)return null;var e=this.buildOptions(a,c.EventDesc.optionProperties),f=new c.EventDesc(d,e,b);return this.wireDeclaredChangeHandler(f,c.DOM.attrValue(a,"onchange")),this.wireDeclaredTriggerHandler(f,c.DOM.attrValue(a,"ontrigger")),f},populateElementObjects:function(a,b){if(null!=a&&null!=a.childNodes)for(var c=this.current(),d=a.firstElementChild;null!=d;)b&&b(d,c),d=d.nextElementSibling},buildOptions:function(a,b){var d={};if(null==b||!c.isArray(b))return d;for(var e=0;e<b.length;e++){var f=b[e],g=c.DOM.attrValue(a,f);null!=g&&(d[f]=g)}return d},wireDeclaredChangeHandler:function(a,b){this.wireDeclaredHandler(a,a.ondeclaredchange,b)},wireDeclaredSetHandler:function(a,b){this.wireDeclaredHandler(a,a.ondeclaredset,b)},wireDeclaredInvokeHandler:function(a,b){this.wireDeclaredHandler(a,a.ondeclaredinvoke,b)},wireDeclaredTriggerHandler:function(a,b){this.wireDeclaredHandler(a,a.ondeclaredtrigger,b)},wireDeclaredParamAddHandler:function(a,b){this.wireDeclaredHandler(a,a.ondeclaredparamadd,b)},wireDeclaredParamRemoveHandler:function(a,b){this.wireDeclaredHandler(a,a.ondeclaredparamremove,b)},wireDeclaredParamChangeHandler:function(a,b){this.wireDeclaredHandler(a,a.ondeclaredparamchange,b)},wireDeclaredHandler:function(a,b,d){if(null!=b){var e=c.findFunction(d);null!=e&&c.isFunction(e)&&b.call(a,e)}},connectWidget:function(a,b,d){var e=this.current();e.connected()||(d?(c.log("widget: connect {id: "+a+"}"),e.connect(a),this.getset("connected",!0)):c.log("widget: standalone {id: "+a+"}"),this.paramValues=b||{})},startWidgetWithPageParams:function(){var a=this.current();a.started()&&(this.setParamValues(a,this.paramValues),a.setPopulatedFromPage())},getParamValuesFromQueryString:function(){var a=c.Util.queryString();return a},setParamValues:function(a,b,c){var d=a.params();null!=d&&d.each(function(a){var d=c?a.shortname()||a.name():a.name(),e=b[d];void 0===e&&(e=a.defvalue()),void 0!==d&&a.value(e)})},isValidSvidgetElement:function(a,b){return null!=a&&a.localName==b&&a.namespaceURI==c.Namespaces.svidget},current:function(){return this.getset("current")},connected:function(){return this.getset("connected")},receiveFromParent:function(a,b){c.log("widget: receiveFromParent {name: "+a+"}"),"start"==a?this.handleReceiveParentStart(b):"actioninvoke"==a?this.handleReceiveParentActionInvoke(b):"eventtrigger"==a?this.handleReceiveParentEventTrigger(b):"propertychange"==a&&this.handleReceiveParentPropertyChange(b)},signalStartAck:function(){c.log("widget: signalStartAck {id: "+this.current().id()+"}");var a=this.current().toTransport();this.comm().signalParent("startack",a,this.current().id())},signalParamAdded:function(a){if(this.connected()){c.log("widget: signalParamAdded {id: "+this.current().id()+"}");var b=a.toTransport();this.comm().signalParent("paramadded",b,this.current().id())}},signalParamRemoved:function(a){this.connected()&&(c.log("widget: signalParamRemoved {id: "+this.current().id()+"}"),this.comm().signalParent("paramremoved",a,this.current().id()))},signalParamChanged:function(a,b){this.connected()&&(c.log("widget: signalParamChanged {id: "+this.current().id()+"}"),b.name=a.name(),this.comm().signalParent("paramchanged",b,this.current().id()))},signalParamSet:function(a,b){this.connected()&&(c.log("widget: signalParamSet {id: "+this.current().id()+"}"),b.name=a.name(),this.comm().signalParent("paramset",b,this.current().id()))},signalActionAdded:function(a){if(this.connected()){c.log("widget: signalActionAdded {id: "+this.current().id()+"}");var b=a.toTransport();this.comm().signalParent("actionadded",b,this.current().id())}},signalActionRemoved:function(a){this.connected()&&(c.log("widget: signalActionRemoved {id: "+this.current().id()+"}"),this.comm().signalParent("actionremoved",a,this.current().id()))},signalActionChanged:function(a,b){this.connected()&&(c.log("widget: signalActionChanged {id: "+this.current().id()+"}"),b.name=a.name(),this.comm().signalParent("actionchanged",b,this.current().id()))},signalActionInvoked:function(a,b){this.connected()&&(c.log("widget: signalActionInvoked {id: "+this.current().id()+"}"),b.name=a.name(),this.comm().signalParent("actioninvoked",b,this.current().id()))},signalActionParamAdded:function(a,b){if(this.connected()){c.log("widget: signalActionParamAdded {id: "+this.current().id()+"}");var d=a.toTransport();d.actionName=b,this.comm().signalParent("actionparamadded",d,this.current().id())}},signalActionParamRemoved:function(a,b){if(this.connected()){c.log("widget: signalActionParamRemoved {id: "+this.current().id()+"}");var d={name:a,actionName:b};this.comm().signalParent("actionparamremoved",d,this.current().id())}},signalActionParamChanged:function(a,b,d){this.connected()&&(c.log("widget: signalActionParamChanged {id: "+this.current().id()+"}"),d.name=a.name(),d.actionName=b.name(),this.comm().signalParent("actionparamchanged",d,this.current().id()))},signalEventAdded:function(a){if(this.connected()){c.log("widget: signalEventAdded {id: "+this.current().id()+"}");var b=a.toTransport();this.comm().signalParent("eventadded",b,this.current().id())}},signalEventRemoved:function(a){this.connected()&&(c.log("widget: signalEventRemoved {id: "+this.current().id()+"}"),this.comm().signalParent("eventremoved",a,this.current().id()))},signalEventChanged:function(a,b){this.connected()&&(c.log("widget: signalEventChanged {id: "+this.current().id()+"}"),b.name=a.name(),this.comm().signalParent("eventchanged",b,this.current().id()))},signalEventTriggered:function(a,b){if(this.connected()){c.log("widget: signalEventTriggered {id: "+this.current().id()+"}");var d={name:a.name(),value:b};this.comm().signalParent("eventtriggered",d,this.current().id())}},handleReceiveParentStart:function(a){a=a||{};var b=a.connected!==!1;this.connectWidget(a.id,a.params,b),b&&this.signalStartAck(),this.startWidgetWithPageParams()},handleReceiveParentPropertyChange:function(a){a=a||{};a.type;if("param"==a.type&&"value"==a.propertyName&&null!=a.name){var b=this.current().param(a.name);null!=b&&b.value(a.value)}},handleReceiveParentActionInvoke:function(a){a=a||{};var b=a.action,c=this.current().action(b);null!=c&&c.external()&&c.invokeApply(a.args)},handleReceiveParentEventTrigger:function(a){a=a||{};var b=a.event,c=this.current().event(b);null!=c&&c.external()&&c.trigger(a.data)}},function(a){return new c.Root(a)}});