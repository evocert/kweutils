/* lightrouter.js - Copyright 2014 Gary Green. Licensed under the Apache License, Version 2.0 */!function(t){"undefined"!=typeof exports?module.exports=t():window.LightRouter=t(window)}(function(t){function e(e){this.pathRoot="",this.routes=[],this.type="path",this.path=null,this.hash=null,this.context=this,this.handler=t;var h="([\\w-]+)";if(this.namedParam={match:new RegExp("{("+h+")}","g"),replace:h},e=e||{},e.type&&this.setType(e.type),e.path&&this.setPath(e.path),e.pathRoot&&this.setPathRoot(e.pathRoot),e.hash&&this.setHash(e.hash),e.context&&this.setContext(e.context),e.handler&&this.setHandler(e.handler),e.routes){var s;for(s in e.routes)this.add(s,e.routes[s])}}function h(t,e,h){this.path=t,this.callback=e,this.router=h,this.values=[]}return e.prototype={Route:h,add:function(t,e){return this.routes.push(new this.Route(t,e,this)),this},empty:function(){return this.routes=[],this},setType:function(t){return this.type=t,this},setPathRoot:function(t){return this.pathRoot=t,this},setPath:function(t){return this.path=t,this},setHash:function(t){return this.hash=t,this},setContext:function(t){return this.context=t,this},setHandler:function(t){return this.handler=t,this},getUrl:function(e){var h;if(e=e||this.type,"path"==e){var s=new RegExp("^"+this.pathRoot+"/?");h=this.path||t.location.pathname.substring(1),h=h.replace(s,"")}else"hash"==e&&(h=this.hash||t.location.hash.substring(1));return decodeURI(h)},match:function(t,e){var h=new this.Route(t,e,this);return h.test(this.getUrl())?h.run():void 0},run:function(){var t,e=this.getUrl();for(var h in this.routes)if(t=this.routes[h],t.test(e))return t.run(),t}},h.prototype={regex:function(){var t=this.path;return"string"==typeof t?new RegExp("^"+t.replace(/\//g,"\\/").replace(this.router.namedParam.match,this.router.namedParam.replace)+"$"):t},params:function(){var t,e,h={},s=this.values,r=s,i=0,n=this.path;"string"==typeof n&&(i=1,r=n.match(this.router.namedParam.match));for(e in r)t=i?r[e].replace(this.router.namedParam.match,"$1"):e,h[t]=s[e];return h},test:function(t){var e;return(e=t.match(this.regex()))?(this.values=e.slice(1),!0):!1},run:function(){return"string"==typeof this.callback?this.router.handler[this.callback](this.params()):this.callback.apply(this.router.context,[this.params()])}},e});